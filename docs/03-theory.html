<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Spatially Explicit Capture–Recapture - 3&nbsp; Likelihood-based SECR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-theory-area-search.html" rel="next">
<link href="./02-example.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-theory.html">Theory</a></li><li class="breadcrumb-item"><a href="./03-theory.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Likelihood-based SECR</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatially Explicit Capture–Recapture</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/MurrayEfford/SECRbook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foreword</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Concepts and terminology</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Simple example</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-theory.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Likelihood-based SECR</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-theory-area-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Area search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-theory-special-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Special topics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Performance</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Assumptions and robustness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Empirical validation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-studydesign.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Study design</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Practice</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-secr-package.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">R package secr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-detection-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Detection model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-density-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Density model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-habitat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Habitat mask</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-fittedmodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Working with fitted models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-multisession.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Multiple sessions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-finite-mixtures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Individual heterogeneity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-sex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Sex differences</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Simulation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A01-troubleshooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Troubleshooting <strong>secr</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A02-speed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Faster is better</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A03-spatial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A04-polygondetectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Area and transect search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A05-mark-resight.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Mark-resight models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A06-noneuclidean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Non-Euclidean distances</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A07-telemetry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Telemetry</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A08-parameterizations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Parameterizations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A09-densityappendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Density revisited</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A10-trend.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Trend revisited</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A11-expected-counts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Expected counts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A12-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A99-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#notation" id="toc-notation" class="nav-link active" data-scroll-target="#notation"><span class="header-section-number">3.1</span> Notation</a></li>
  <li><a href="#Likelihood" id="toc-Likelihood" class="nav-link" data-scroll-target="#Likelihood"><span class="header-section-number">3.2</span> Likelihood</a></li>
  <li><a href="#distance-dependent-detection" id="toc-distance-dependent-detection" class="nav-link" data-scroll-target="#distance-dependent-detection"><span class="header-section-number">3.3</span> Distance-dependent detection</a></li>
  <li><a href="#sec-pointdetectors" id="toc-sec-pointdetectors" class="nav-link" data-scroll-target="#sec-pointdetectors"><span class="header-section-number">3.4</span> Detector types</a></li>
  <li><a href="#sec-fixedN" id="toc-sec-fixedN" class="nav-link" data-scroll-target="#sec-fixedN"><span class="header-section-number">3.5</span> Fixed <span class="math inline">N</span></a></li>
  <li><a href="#sec-confidenceintervals" id="toc-sec-confidenceintervals" class="nav-link" data-scroll-target="#sec-confidenceintervals"><span class="header-section-number">3.6</span> Confidence intervals</a></li>
  <li><a href="#varying-effort" id="toc-varying-effort" class="nav-link" data-scroll-target="#varying-effort"><span class="header-section-number">3.7</span> Varying effort</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-theory.html">Theory</a></li><li class="breadcrumb-item"><a href="./03-theory.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Likelihood-based SECR</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-theory" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Likelihood-based SECR</span></span></h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<p>Part II provides background on the theory of SECR that is mostly for reference. This chapter covers general notation and theory for point detectors. <a href="04-theory-area-search.html" class="quarto-xref"><span>Chapter 4</span></a> describes theory for area and transect searches. <a href="05-theory-special-topics.html" class="quarto-xref"><span>Chapter 5</span></a> has extensions for multiple sessions, groups, effective sampling area, conditional estimation, relative density, population size, finite mixtures, hybrid mixture models, alternative parameterizations and model-based location of activity centres (‘fxi’). These chapters aim to be independent of any particular implementation, although some cross-references to <strong>secr</strong> creep in.</p>
<section id="notation" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="notation"><span class="header-section-number">3.1</span> Notation</h2>
<p>We use notation and terminology from <span class="citation" data-cites="be08">Borchers &amp; Efford (<a href="A99-references.html#ref-be08" role="doc-biblioref">2008</a>)</span>, with minor variations and extensions from <span class="citation" data-cites="ebb09">Efford et al. (<a href="A99-references.html#ref-ebb09" role="doc-biblioref">2009</a>)</span>, <span class="citation" data-cites="e11">Efford (<a href="A99-references.html#ref-e11" role="doc-biblioref">2011</a>)</span> and elsewhere (<a href="#tbl-notation" class="quarto-xref">Table&nbsp;<span>3.1</span></a>).</p>
<p></p>
<div id="tbl-notation" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-notation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.1: Mathematical notation for SECR
</figcaption>
<div aria-describedby="tbl-notation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Symbol</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">General</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">AC</td>
<td style="text-align: left;">activity centre</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\mathbf x</span></td>
<td style="text-align: left;">point <span class="math inline">(x,y)</span> in the plane</td>
</tr>
<tr class="even">
<td style="text-align: left;">Data</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">n</span></td>
<td style="text-align: left;">number of individuals detected</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">S</span></td>
<td style="text-align: left;">number of sampling occasions</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">K</span></td>
<td style="text-align: left;">number of detectors</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\omega_i</span></td>
<td style="text-align: left;">spatial detection history of the <span class="math inline">i</span>-th animal</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\Omega</span></td>
<td style="text-align: left;">set of all detection histories <span class="math inline">\omega_i, i = 1..n</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Parameters</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">D(\mathbf x; \phi)</span><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></td>
<td style="text-align: left;">intensity at <span class="math inline">\mathbf x</span> of AC Poisson point process</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\phi</span></td>
<td style="text-align: left;">parameter vector for AC point process</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\theta</span></td>
<td style="text-align: left;">vector of detection parameters (minimally <span class="math inline">(g_0, \sigma)</span> or <span class="math inline">(\lambda_0,\sigma)</span>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">g_0</span></td>
<td style="text-align: left;">intercept of distance-probability-of-detection function</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\lambda_0</span></td>
<td style="text-align: left;">intercept of distance-hazard-of-detection function</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\sigma</span></td>
<td style="text-align: left;">spatial scale parameter of distance-detection function</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Model</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">d_k(\mathbf x)</span></td>
<td style="text-align: left;">distance of point <span class="math inline">\mathbf x</span> from detector <span class="math inline">k</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\lambda(d)</span></td>
<td style="text-align: left;">hazard of detection at distance <span class="math inline">d</span> (distance-hazard-of-detection function)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">g(d)</span></td>
<td style="text-align: left;">probability of detection at distance <span class="math inline">d</span> (distance-probability-of-detection function)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">p_\cdot(\mathbf x; \theta)</span></td>
<td style="text-align: left;">probability that an individual with AC at <span class="math inline">\mathbf x</span> is detected at least once</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">h_{isk}(\mathbf x; \theta)</span></td>
<td style="text-align: left;">hazard of detection at detector <span class="math inline">k</span> for animal <span class="math inline">i</span> on occasion <span class="math inline">s</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">p_{isk}(\mathbf x; \theta)</span></td>
<td style="text-align: left;">probability of detection corresponding to <span class="math inline">h_{isk}(\mathbf x; \theta)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">p_{k}(\mathbf x; \theta)</span></td>
<td style="text-align: left;"><span class="math inline">p_{isk}(\mathbf x; \theta)</span> constant across individuals <span class="math inline">i</span> and occasions <span class="math inline">s</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\Lambda(\phi, \theta)</span></td>
<td style="text-align: left;">expected number of detected individuals <span class="math inline">n</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Habitat</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">A</span></td>
<td style="text-align: left;">potential habitat (‘habitat mask’, ‘state space’) <span class="math inline">A \subset R^2</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">|A|</span></td>
<td style="text-align: left;">area of <span class="math inline">A</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">N(A)</span></td>
<td style="text-align: left;">number of AC in <span class="math inline">A</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="Likelihood" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="Likelihood"><span class="header-section-number">3.2</span> Likelihood</h2>
<p></p>
<p>Parameters of the state model (<span class="math inline">\phi</span>) and the detection model (<span class="math inline">\theta</span>) are estimated jointly by maximizing the logarithm of the likelihood:</p>
<p><span id="eq-L"><span class="math display">
L(\phi, \theta | \Omega ) = \mathrm{Pr}(n| \phi, \theta) \; \mathrm{Pr}(\Omega | n, \phi, \theta).
\tag{3.1}</span></span></p>
<p>When density is constant across space, <span class="math inline">\phi</span> drops out of the rightmost term, which then relates to the detection (observation) model alone, and maximization of this component gives unbiased estimates of <span class="math inline">\theta</span> (see <a href="05-theory-special-topics.html#conditional">Conditional likelihood</a>).</p>
<section id="Pr-n" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="Pr-n"><span class="header-section-number">3.2.1</span> Number of individuals</h3>
<p> If AC follow an inhomogeneous Poisson process then <span class="math inline">n</span> has a Poisson distribution with parameter <span id="eq-n"><span class="math display">
\Lambda(\phi, \theta) = \int_{R^2} D(\mathbf x; \phi) \, p_\cdot(\mathbf x;\theta) \, d\mathbf x,
\tag{3.2}</span></span> where <span class="math inline">D(\mathbf x; \phi)</span> is the density at <span class="math inline">\mathbf x</span> and <span class="math inline">p_\cdot(\mathbf x|\theta)</span> is the overall probability of detecting an AC at <span class="math inline">\mathbf x</span> (see <a href="#sec-pointdetectors" class="quarto-xref"><span>Section 3.4</span></a> and <a href="04-theory-area-search.html" class="quarto-xref"><span>Chapter 4</span></a>). Thus <span class="math inline">\mathrm{Pr}(n | \phi, \theta) = \Lambda^n \exp (-\Lambda) / n!</span>.</p>
<p>If the population size in a defined area <span class="math inline">A</span> is considered to be <a href="#sec-fixedN">fixed</a> rather than Poisson then the distribution of <span class="math inline">n</span> is binomial with size <span class="math inline">N(A)</span>.</p>
</section>
<section id="Pr-omega" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="Pr-omega"><span class="header-section-number">3.2.2</span> Detection histories</h3>
<p>In general we have <span id="eq-CL"><span class="math display">
\mathrm{Pr} (\Omega | n, \phi, \theta) = \binom {n}{n_1,...,n_C}
\prod_{i=1}^n \mathrm{Pr}( \omega_i | \omega_i&gt;0, \phi, \theta),
\tag{3.3}</span></span></p>
<p>where <span class="math inline">\omega_i&gt;0</span> indicates a non-empty detection history. The multinomial coefficient uses the frequencies <span class="math inline">n_1,...,n_C</span> of each of the <span class="math inline">C</span> observed histories. The coefficient is a constant not involving parameters and it can be omitted without changing the model fit (consistent inclusion or exclusion is needed for valid likelihood-based comparisons such as those using AIC).</p>
<p>We do not know the true AC locations, but they can be integrated<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> out of the likelihood using an expression for their spatial distribution, i.e.&nbsp;<span id="eq-omegai"><span class="math display">
\mathrm{Pr}( \omega_i | \omega_i&gt;0, \phi, \theta) = \int_{R^2} \mathrm{Pr}( \omega_i | \omega_i&gt;0, \theta, \mathbf x) \, f(\mathbf x | \omega_i&gt;0, \phi, \theta) \; d\mathbf x
\tag{3.4}</span></span> where <span class="math inline">f(\mathbf x| \omega_i&gt;0, \phi, \theta)</span> is the conditional density of an AC given that the individual was detected. The conditional density is given by <span id="eq-f"><span class="math display">
f(\mathbf x| \omega_i&gt;0, \phi, \theta) = \frac{D(\mathbf x ; \phi) p_\cdot(\mathbf x ; \theta)}{\Lambda(\phi,\theta)}.
\tag{3.5}</span></span></p>
</section>
</section>
<section id="distance-dependent-detection" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="distance-dependent-detection"><span class="header-section-number">3.3</span> Distance-dependent detection</h2>
<p></p>
<p>The key idea of SECR is that the probability of detecting a particular animal at a particular detector on one occasion can be represented as a function of the distance between its AC and the detector. The function should decline effectively to zero at large distances. Distances are not observed directly, and we rely on functions of somewhat arbitrary shape. Fortunately, the estimates are not very sensitive to the choice. Detection functions are covered in detail in <a href="10-detection-model.html" class="quarto-xref"><span>Chapter 10</span></a>. Either probability <span class="math inline">g(d)</span> or hazard <span class="math inline">\lambda(d)</span> may be modelled as a function of distance. A halfnormal form is commonly used (e.g., <span class="math inline">g(d) = g_0 \exp (-d^2/2/\sigma^2)</span>). The shapes of, e.g., halfnormal <span class="math inline">g(d)</span> and halfnormal <span class="math inline">\lambda_0(d)</span> are only subtly different, but <span class="math inline">\lambda(d)</span> is preferred because it lends itself to mathematical manipulation and occurs more widely in the literature (often with different notation).</p>
<p>The function <span class="math inline">\lambda(d)</span> may be transformed into a probability with <span class="math inline">g(d) = 1 - \exp[-\lambda(d)]</span> and the reverse transformation is <span class="math inline">\lambda(d) = -\log[1-g(d)]</span>. The intercept parameter <span class="math inline">g_0</span> has been replaced by <span class="math inline">\lambda_0</span>; although the name <span class="math inline">\sigma</span> is retained for the spatial scale parameter this is not exactly interchangeable between the models.</p>
</section>
<section id="sec-pointdetectors" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="sec-pointdetectors"><span class="header-section-number">3.4</span> Detector types</h2>
<p> </p>
<p>The SECR data <span class="math inline">\omega_i</span> for each detected individual comprise a matrix with dimensions <span class="math inline">S</span> (occasions) and <span class="math inline">K</span> (detectors). Each element may be binary (0/1) or integer (0, 1, 2, …). Various probability models exist for the entries <span class="math inline">\omega_{isk}</span>. The appropriate probability model follows in most cases directly from the type of detector device; we therefore classify probability models according to device type. <a href="#tbl-detectortypes" class="quarto-xref">Table&nbsp;<span>3.2</span></a> matches this classification to that of <span class="citation" data-cites="rcsg14">Royle et al. (<a href="A99-references.html#ref-rcsg14" role="doc-biblioref">2014</a>)</span>. This section covers passive detection at a point; <a href="#areasearches">area searches</a> are considered later.</p>
<div id="tbl-detectortypes" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-detectortypes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.2: Detector types based on <span class="citation" data-cites="eb19">Efford &amp; Boulanger (<a href="A99-references.html#ref-eb19" role="doc-biblioref">2019</a>, Table 1)</span> with cross references to <span class="citation" data-cites="rcsg14">Royle et al. (<a href="A99-references.html#ref-rcsg14" role="doc-biblioref">2014</a>)</span>
</figcaption>
<div aria-describedby="tbl-detectortypes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<colgroup>
<col style="width: 32%">
<col style="width: 18%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Detector type</th>
<th style="text-align: left;">Royle et al.</th>
<th style="text-align: left;">Data</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Binary proximity</td>
<td style="text-align: left;">Bernoulli<sup>1</sup></td>
<td style="text-align: left;">binary animal <span class="math inline">\times</span> occasion <span class="math inline">\times</span> detector</td>
</tr>
<tr class="even">
<td style="text-align: left;">Count proximity</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Poisson</td>
<td style="text-align: left;">Poisson</td>
<td style="text-align: left;">integer animal <span class="math inline">\times</span> occasion <span class="math inline">\times</span> detector</td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Binomial</td>
<td style="text-align: left;">Binomial</td>
<td style="text-align: left;">integer animal <span class="math inline">\times</span> occasion <span class="math inline">\times</span> detector</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multi-catch trap</td>
<td style="text-align: left;">Multinomial</td>
<td style="text-align: left;">binary animal <span class="math inline">\times</span> occasion</td>
</tr>
<tr class="even">
<td style="text-align: left;">Single-catch trap</td>
<td style="text-align: left;">—</td>
<td style="text-align: left;">binary animal <span class="math inline">\times</span> occasion, exclusive</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Area search</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">integer animal <span class="math inline">\times</span> occasion <span class="math inline">\times</span> detector</td>
</tr>
<tr class="even">
<td style="text-align: left;">Transect search</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">integer animal <span class="math inline">\times</span> occasion <span class="math inline">\times</span> detector</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Exclusive area search<sup>2</sup></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">binary animal <span class="math inline">\times</span> occasion</td>
</tr>
<tr class="even">
<td style="text-align: left;">Exclusive transect search<sup>2</sup></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">binary animal <span class="math inline">\times</span> occasion</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<ol type="1">
<li>Also ‘Binomial’ in <span class="citation" data-cites="rg11">Royle &amp; Gardner (<a href="A99-references.html#ref-rg11" role="doc-biblioref">2011</a>)</span></li>
<li>‘Exclusive’ here means that an individual can be detected at no more than one detector (polygon or transect) per occasion.</li>
</ol>
<p>For each type of detector we require <span class="math inline">\mathrm{Pr}(\omega_{isk} | \mathbf x)</span> and the overall probability of detection <span class="math inline">p_\cdot(\mathbf x)</span>. For some detector types it is more natural to express the probability in terms of the occasion- and trap-specific hazard <span class="math inline">h_{sk} = \lambda[d_k(\mathbf x); \theta^\prime]  = -\log(1-g[d_k(\mathbf x); \theta])</span> than the probability <span class="math inline">p_{sk} (\mathbf x) = g[d_k(\mathbf x); \theta] = 1 - \exp\{-\lambda[d_k(\mathbf x); \theta^\prime]\}</span><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<p>We summarise the probability models in <a href="#tbl-pointdetectortypes" class="quarto-xref">Table&nbsp;<span>3.3</span></a>, with comments on each point detector type below.</p>
<div id="tbl-pointdetectortypes" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pointdetectortypes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.3: Summary of point detector types (conditioning on <span class="math inline">\theta</span> omitted to save space)
</figcaption>
<div aria-describedby="tbl-pointdetectortypes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<colgroup>
<col style="width: 20%">
<col style="width: 45%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Detector type</th>
<th style="text-align: left;"><span class="math inline">\mathrm{Pr}(\omega_{isk} | \mathbf x)</span></th>
<th style="text-align: left;"><span class="math inline">p_\cdot(\mathbf x)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Binary proximity</td>
<td style="text-align: left;"><span class="math inline">p_{sk}(\mathbf x) ^{\omega_{isk}} [1-p_{sk}(\mathbf x)]^{(1-\omega_{isk})}</span></td>
<td style="text-align: left;"><span class="math inline">1 - \prod_s\prod_k 1 - p_{sk} (\mathbf x)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Count proximity</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Poisson</td>
<td style="text-align: left;"><span class="math inline">\{h_{sk} (\mathbf x)^{\omega_{isk}} \exp [-h_{sk}(\mathbf x)]\} / \omega_{isk}!</span></td>
<td style="text-align: left;"><span class="math inline">1 - \exp [- \sum_s \sum_k h_{sk}(\mathbf x)]</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Binomial<sup>1</sup></td>
<td style="text-align: left;"><span class="math inline">\binom{B_s}{\omega_{isk}} p_{sk}(\mathbf x)^{\omega_{isk}} [1-p_{sk}(\mathbf x)]^{(B_s-\omega_{isk})}</span></td>
<td style="text-align: left;"><span class="math inline">1 - \prod_s\prod_k [1 - p_{sk} (\mathbf x)]^{B_s}</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multi-catch trap<sup>2</sup></td>
<td style="text-align: left;"><span class="math inline">\{1 - \exp [-H_s(\mathbf x)]\}\frac{h_{sk}(\mathbf x)}{H_s(\mathbf x)}</span></td>
<td style="text-align: left;"><span class="math inline">1 - \exp[ -\sum_s H_s(\mathbf x)]</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<ol type="1">
<li><span class="math inline">B_s</span> is the size of the binomial distribution, the number of opportunities for detection, assumed constant across detectors</li>
<li><span class="math inline">H_s = \sum_k h_{sk}(\mathbf x)</span> is the hazard summed over traps</li>
</ol>
<!-- ::: {.content-visible when-format="pdf"} -->
<!-- | Detector type               | $\mathrm{Pr}(\omega_{isk} | \mathbf x)$                                                                   | $p_\cdot(\mathbf x)$                                | -->
<!-- |:----------------------|:------------------------|:------------------------| -->
<!-- | Binary proximity            | $p_{sk}(\mathbf x) ^{\omega_{isk}} [1-p_{sk}(\mathbf x)]^{(1-\omega_{isk})}$                            | $1 - \prod_s\prod_k 1 - p_{sk} (\mathbf x)$         | -->
<!-- | Poisson count proximity     | $\{h_{sk} (\mathbf x)^{\omega_{isk}} \exp [-h_{sk}(\mathbf x)]\} / \omega_{isk}!$                       | $1 - \exp [- \sum_s \sum_k h_{sk}(\mathbf x)]$      | -->
<!-- | Binomial count proximity^1^ | $\binom{B_s}{\omega_{isk}} p_{sk}(\mathbf x)^{\omega_{isk}} [1-p_{sk}(\mathbf x)]^{(B_s-\omega_{isk})}$ | $1 - \prod_s\prod_k [1 - p_{sk} (\mathbf x)]^{B_s}$ | -->
<!-- | Multi-catch trap^2^         | $\{1 - \exp [-H_s(\mathbf x)]\}\frac{h_{sk}(\mathbf x)}{H_s(\mathbf x)}$                                | $1 - \exp[ -\sum_s H_s(\mathbf x)]$                 | -->
<!-- : Summary of point detector types (conditioning on $\theta$ omitted to -->
<!-- save space) {#tbl-pointdetectortypes  tbl-colwidths="[30,40,30]" .sm} -->
<!-- \ -->
<!-- 1.  $B_s$ is the size of the binomial distribution, the number of -->
<!--     opportunities for detection, assumed constant across detectors -->
<!-- 2.  $H_s = \sum_k h_{sk}(\mathbf x)$ is the hazard summed over traps -->
<!-- ::: -->
<section id="binary-proximity-detector" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="binary-proximity-detector"><span class="header-section-number">3.4.1</span> Binary proximity detector</h3>
<p></p>
<p>A proximity detector records the presence of an individual at or near a point without restricting its movement. The data are binary when any detections after the first are ignored (this avoids worries about the non-independence of repeated visits to a detector).</p>
<p>Assuming independence among detectors, the distance-detection model applies directly as the probability of detection in a particular detector, and the overall probability of detection is the complement of the product of probabilities of non-detection in all detectors.</p>
</section>
<section id="poisson-count-proximity-detector" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="poisson-count-proximity-detector"><span class="header-section-number">3.4.2</span> Poisson count proximity detector</h3>
<p></p>
<p>Hazard is the natural scale for the Poisson parameter.</p>
</section>
<section id="binomial-count-proximity-detector" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="binomial-count-proximity-detector"><span class="header-section-number">3.4.3</span> Binomial count proximity detector</h3>
<p></p>
<p>Binomial counts arise when there is a finite number of opportunities for detection within each occasion that we denote <span class="math inline">B_s</span>. This commonly happens when binary proximity data are collapsed to a single occasion: the initial number of occasions is known (<span class="math inline">B_s = S</span>) and places an upper limit on the count. Collapsing is often efficient. It precludes modelling parameter variation or learned responses across occasions.</p>
<p>Each count is binomial with size <span class="math inline">B_s</span> and probability equal to the per-occasion detection probability.</p>
</section>
<section id="multi-catch-trap" class="level3" data-number="3.4.4">
<h3 data-number="3.4.4" class="anchored" data-anchor-id="multi-catch-trap"><span class="header-section-number">3.4.4</span> Multi-catch trap</h3>
<p> </p>
<p>A trap is a device that detains an animal until it is released, allowing only one detection of that animal per occasion. The single-detector, single-AC probability from a distance-dependent detection function (preceding section) must be modified to allow for prior capture in a different trap: traps effectively “compete” for animals. If the trap remains open for captures of further animals then the solution is a straightforward competing risk model <span class="citation" data-cites="be08">(<a href="A99-references.html#ref-be08" role="doc-biblioref">Borchers &amp; Efford, 2008</a>)</span>.</p>
<p>The competing risk model uses the occasion- and trap-specific hazard <span class="math inline">h_{sk}</span>.</p>
</section>
<section id="sec-singlecatch" class="level3" data-number="3.4.5">
<h3 data-number="3.4.5" class="anchored" data-anchor-id="sec-singlecatch"><span class="header-section-number">3.4.5</span> Single-catch trap</h3>
<p> </p>
<p>A single-catch trap can only catch one animal at a time. This entails competition both among traps for animals and among animals for traps. No simple likelihood is available. Simulation-based methods <span class="citation" data-cites="e04 Efford2023">(<a href="A99-references.html#ref-e04" role="doc-biblioref">Efford, 2004</a>, <a href="A99-references.html#ref-Efford2023" role="doc-biblioref">2023</a>)</span> must be used for unbiased estimation of <span class="math inline">\theta</span> and trend in density unless the time of detection has been recorded <span class="citation" data-cites="Distiller2015">(<a href="A99-references.html#ref-Distiller2015" role="doc-biblioref">Distiller &amp; Borchers, 2015</a>)</span>.</p>
</section>
</section>
<section id="sec-fixedN" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="sec-fixedN"><span class="header-section-number">3.5</span> Fixed <span class="math inline">N</span></h2>
<p></p>
<p>The formulation of the state model as an inhomogeneous Poisson process (<a href="01-basics.html" class="quarto-xref"><span>Chapter 1</span></a>) does not refer to population size <span class="math inline">N</span>. The state model may also be cast as a ‘conditional’ or ‘binomial’ Poisson process’ <span class="citation" data-cites="illian08">(<a href="A99-references.html#ref-illian08" role="doc-biblioref">Illian et al., 2008</a>)</span>. For an arbitrary area <span class="math inline">A</span> the number of AC is then considered fixed rather than Poisson.</p>
<p>The distribution of <span class="math inline">n</span> is then binomial with size <span class="math inline">N(A)</span> and probability <span class="math inline">p_c(\phi, \theta) = \int_A p_\cdot(\mathbf x; \theta) f(\mathbf x; \phi) d\mathbf x</span>, where <span class="math inline">f(\mathbf x; \phi) = D(\mathbf x; \phi) / \int_A D(\mathbf x; \phi) d\mathbf x</span>.</p>
<p>The form conditional on <span class="math inline">N(A)</span> leads to narrower confidence intervals for density owing to the exclusion of variation in <span class="math inline">N(A)</span> among realisations of the Poisson process for AC. This makes sense when <span class="math inline">A</span> contains an isolated population with a natural boundary, but most applications do not meet this criterion.</p>
</section>
<section id="sec-confidenceintervals" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="sec-confidenceintervals"><span class="header-section-number">3.6</span> Confidence intervals</h2>
<p></p>
<p>Maximizing the log likelihood leads to a straightforward estimate of the asymptotic covariance matrix <span class="math inline">\mathbf V</span> of the beta parameters. If <span class="math inline">\hat \theta</span> is the vector of estimates and <span class="math inline">\mathbf H(\hat \theta)</span> is the Hessian matrix evaluated at <span class="math inline">\hat \theta</span> then an estimate of the covariance matrix is <span class="math inline">\hat {\mathbf V} = \mathbf H(\hat \theta)^{-1}</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hessian
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Hessian matrix is the square matrix of second-order partial derivatives of the log likelihood. For more on asymptotic variances of MLE see <span class="citation" data-cites="s82">Seber (<a href="A99-references.html#ref-s82" role="doc-biblioref">1982</a>)</span>, <span class="citation" data-cites="Borchers2002">Borchers et al. (<a href="A99-references.html#ref-Borchers2002" role="doc-biblioref">2002</a>)</span>, <span class="citation" data-cites="cw">Cooch &amp; White (<a href="A99-references.html#ref-cw" role="doc-biblioref">2023</a>)</span> 1.3.2, and many statistics texts.</p>
</div>
</div>
<p>The sampling error of MLE is asymptotically normal, and symmetric (Wald) intervals for SECR parameters appear to work well on the link scale i.e. <span class="math inline">\hat \theta_j \pm z_{\alpha/2} \hat \sigma_j</span> is a <span class="math inline">100(1-\alpha)\%</span> interval for <span class="math inline">\hat \theta_j</span> where <span class="math inline">-z_{\alpha/2}</span> is the <span class="math inline">\alpha/2</span> quantile of the standard normal deviate (<span class="math inline">z_{0.025} = 1.96</span>) and <span class="math inline">\hat \sigma_j^2</span> is the estimated variance from <span class="math inline">\hat{\mathbf V}</span>.</p>
<p>On back transformation to the natural (‘real’) scale these intervals become asymmetrical and generally have good coverage properties.</p>
<p>The method of profile likelihood is also available (e.g., <span class="citation" data-cites="Evans1996">Evans et al. (<a href="A99-references.html#ref-Evans1996" role="doc-biblioref">1996</a>)</span>; <code>secr::confint.secr</code>), but it is seldom used as no problem has been shown with intervals based on asymptotic variances. Similarly, the additional computation required by parametric bootstrap methods is not usually warranted.</p>
</section>
<section id="varying-effort" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="varying-effort"><span class="header-section-number">3.7</span> Varying effort</h2>
<p></p>
<p>When sampling effort varies between detectors or over time in a capture–recapture study we expect a commensurate change in the number of detections. Allowing for known variation in effort when modelling detections has these benefits:</p>
<ul>
<li>detection parameters are related to a consistent unit of effort (e.g., one trap set for one day)</li>
<li>the fit of the detection model is improved</li>
<li>trends in the estimates may be modelled without confounding.</li>
</ul>
<p><span class="citation" data-cites="be08">Borchers &amp; Efford (<a href="A99-references.html#ref-be08" role="doc-biblioref">2008</a>)</span> allowed the duration of exposure to vary between sampling occasions in their competing-hazard model for multi-catch traps. <span class="citation" data-cites="ebm13">Efford et al. (<a href="A99-references.html#ref-ebm13" role="doc-biblioref">2013</a>)</span> generalised the method to allow joint variation in effort over detectors and over time (occasions), and considered other detector types.</p>
<p>We use <span class="math inline">T_{sk}</span> for the effort on occasion <span class="math inline">s</span> at detector <span class="math inline">k</span>. At its simplest, <span class="math inline">T_{sk}</span> can be a binary indicator taking the values 0 (detector not used) or 1 (detector used) (when <span class="math inline">T_{sk} = 0</span>, no detections are possible and <span class="math inline">\omega_{isk} = 0</span>). For small, continuously varying, <span class="math inline">T_{sk}</span> we expect the number of detections to increase linearly with <span class="math inline">T_{sk}</span>; saturation may occur at higher effort, depending on the detector type. Examples of possible effort variables are the number of days that each automatic camera was operated in a tiger study, or the number of rub trees sampled for DNA in each grid cell of a grizzly bear study.</p>
<p>Following convention in non-spatial capture–recapture <span class="citation" data-cites="cw">(<a href="A99-references.html#ref-cw" role="doc-biblioref">Cooch &amp; White, 2023</a>)</span> we could model <span class="math inline">g_0</span> or <span class="math inline">\lambda_0</span> on the link scale (logit or log) as a linear function of <span class="math inline">T_{sk}</span> (a time covariate if constant across detectors, a detector covariate if constant across occasions, or a time-varying detector-level covariate). However, this is suboptimal because varying effort has a linear effect only on <span class="math inline">\lambda_0</span> for Poisson count detectors, and the estimation of additional parameters is an unnecessary burden. <span class="math inline">T_{sk}</span> is like an offset in a generalised linear model: it can be included in the SECR model without estimating an additional coefficient.</p>
<p>The SECR models for various detectors (<a href="#tbl-pointdetectortypes" class="quarto-xref">Table&nbsp;<span>3.3</span></a>) are expressed in terms of either the probability <span class="math inline">p_{sk}</span> or the hazard <span class="math inline">h_{sk}</span>. Each of these scales differently with <span class="math inline">T_{sk}</span> as shown in <a href="#tbl-effort" class="quarto-xref">Table&nbsp;<span>3.4</span></a>. Only in the Poisson case is the expected number of detections linear on effort.</p>
<div id="tbl-effort" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-effort-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.4: Including effort in SECR models for various detector types. <span class="math inline">p^\prime_{sk}(\mathbf x)</span> and <span class="math inline">h^\prime_{sk}(\mathbf x)</span> replace the matching quantities in <a href="#tbl-pointdetectortypes" class="quarto-xref">Table&nbsp;<span>3.3</span></a>.
</figcaption>
<div aria-describedby="tbl-effort-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<colgroup>
<col style="width: 40%">
<col style="width: 60%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Detector type</th>
<th style="text-align: left;">Adjusted probability or hazard</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Multi-catch trap</td>
<td style="text-align: left;"><span class="math inline">h^\prime_{sk}(\mathbf x) = h_{sk}(\mathbf x) T_{sk}</span>; <span class="math inline">H^\prime_s(\mathbf x) = \sum_k h^\prime_{sk}(\mathbf x)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Binary proximity</td>
<td style="text-align: left;"><span class="math inline">p^\prime_{sk}(\mathbf x) = 1 - (1 - p_{sk}(\mathbf x))^{T_{sk}}</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Poisson count proximity</td>
<td style="text-align: left;"><span class="math inline">h^\prime_{sk}(\mathbf x) = h_{sk}(\mathbf x) T_{sk}</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Binomial count proximity</td>
<td style="text-align: left;">see below</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>For binomial count detectors we use a formulation not based directly on instantaneous hazard, as explained by <span class="citation" data-cites="ebm13">Efford et al. (<a href="A99-references.html#ref-ebm13" role="doc-biblioref">2013</a>)</span>. For these detectors <span class="math inline">T_{sk}</span> (assumed integer) is taken as the size of the binomial (maximum possible detections) and <span class="math inline">p_{sk}(\mathbf x)</span> is unchanged.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-Borchers2002" class="csl-entry" role="listitem">
Borchers, D. L., Buckland, S. T., &amp; Zucchini, W. (2002). Estimating animal abundance. In <em>Statistics for Biology and Health</em>. Springer London. <a href="https://doi.org/10.1007/978-1-4471-3708-5">https://doi.org/10.1007/978-1-4471-3708-5</a>
</div>
<div id="ref-be08" class="csl-entry" role="listitem">
Borchers, D. L., &amp; Efford, M. G. (2008). Spatially explicit maximum likelihood methods for capture-recapture studies. <em>Biometrics</em>, <em>64</em>, 377–385.
</div>
<div id="ref-cw" class="csl-entry" role="listitem">
Cooch, E., &amp; White, G. (Eds.). (2023). <em>Program MARK: A gentle introduction.</em> (23rd ed.). <a href="http://www.phidot.org/software/mark/docs/book/">http://www.phidot.org/software/mark/docs/book/</a>
</div>
<div id="ref-Distiller2015" class="csl-entry" role="listitem">
Distiller, G., &amp; Borchers, D. L. (2015). A spatially explicit capture–recapture estimator for single‐catch traps. <em>Ecology and Evolution</em>, <em>5</em>(21), 5075–5087. <a href="https://doi.org/10.1002/ece3.1748">https://doi.org/10.1002/ece3.1748</a>
</div>
<div id="ref-e04" class="csl-entry" role="listitem">
Efford, M. G. (2004). Density estimation in live-trapping studies. <em>Oikos</em>, <em>106</em>, 598–610.
</div>
<div id="ref-e11" class="csl-entry" role="listitem">
Efford, M. G. (2011). Estimation of population density by spatially explicit capture-recapture analysis of data from area searches. <em>Ecology</em>, <em>92</em>, 2202–2207.
</div>
<div id="ref-Efford2023" class="csl-entry" role="listitem">
Efford, M. G. (2023). <span class="nocase">ipsecr: An R package for awkward spatial capture–recapture data</span>. <em>Methods in Ecology and Evolution</em>, <em>14</em>(5), 1182–1189. <a href="https://doi.org/10.1111/2041-210x.14088">https://doi.org/10.1111/2041-210x.14088</a>
</div>
<div id="ref-ebb09" class="csl-entry" role="listitem">
Efford, M. G., Borchers, D. L., &amp; Byrom, A. E. (2009). Density estimation by spatially explicit capture-recapture: Likelihood-based methods. In D. L. Thomson, E. G. Cooch, &amp; M. J. Conroy (Eds.), <em>Modeling demographic processes in marked populations</em> (pp. 255–269). Springer.
</div>
<div id="ref-ebm13" class="csl-entry" role="listitem">
Efford, M. G., Borchers, D. L., &amp; Mowat, G. (2013). Varying effort in capture-recapture studies. <em>Methods in Ecology and Evolution</em>, <em>4</em>, 629–636.
</div>
<div id="ref-eb19" class="csl-entry" role="listitem">
Efford, M. G., &amp; Boulanger, J. (2019). Fast evaluation of study designs for spatially explicit capture-recapture. <em>Methods in Ecology and Evolution</em>, <em>10</em>, 1529–1535. <a href="https://doi.org/10.1111/2041-210X.13239">https://doi.org/10.1111/2041-210X.13239</a>
</div>
<div id="ref-Evans1996" class="csl-entry" role="listitem">
Evans, M. A., Kim, H.-M., &amp; O’Brien, T. E. (1996). An application of profile-likelihood based confidence interval to capture: Recapture estimators. <em>Journal of Agricultural, Biological, and Environmental Statistics</em>, <em>1</em>(1), 131. <a href="https://doi.org/10.2307/1400565">https://doi.org/10.2307/1400565</a>
</div>
<div id="ref-illian08" class="csl-entry" role="listitem">
Illian, J., Penttinen, A., Stoyan, H., &amp; Stoyan, D. (2008). <em>Statistical analysis and modelling of spatial point patterns</em>. Wiley.
</div>
<div id="ref-Kendeigh1944" class="csl-entry" role="listitem">
Kendeigh, S. C. (1944). Measurement of bird populations. <em>Ecological Monographs</em>, <em>14</em>, 67–106. <a href="https://doi.org/10.2307/1961632">https://doi.org/10.2307/1961632</a>
</div>
<div id="ref-rcsg14" class="csl-entry" role="listitem">
Royle, J. A., Chandler, R. B., Sollmann, R., &amp; Gardner, B. (2014). <em>Spatial capture-recapture</em>. Academic Press.
</div>
<div id="ref-rg11" class="csl-entry" role="listitem">
Royle, J. A., &amp; Gardner, B. (2011). Hierarchical spatial capture-recapture models for estimating density from trapping arrays. In A. F. O’Connell, J. D. Nichols, &amp; K. U. Karanth (Eds.), <em>Camera traps in animal ecology: Methods and analyses</em> (pp. 163–190). Springer.
</div>
<div id="ref-s82" class="csl-entry" role="listitem">
Seber, G. A. F. (1982). <em>The estimation of animal abundance and related parameters.</em> (2nd ed.). Griffin.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>We use <span class="math inline">D(\mathbf x)</span> in preference to <span class="math inline">\lambda(\mathbf x)</span> because <span class="math inline">\lambda</span> has multiple meanings.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Integration is commonly performed by summing over many small cells for a finite region near the detectors, as both <span class="math inline">\mathrm{Pr}(\omega_i)</span> and <span class="math inline">f(\mathbf x)</span> decline to zero at greater distances. We state the model in terms of the real plane and defer discussion of the region of integration to <a href="12-habitat.html" class="quarto-xref"><span>Chapter 12</span></a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The parameter vectors <span class="math inline">\theta</span> and <span class="math inline">\theta^\prime</span> differ for detection functions expressed in terms of probability (<span class="math inline">g()</span>) and hazard (<span class="math inline">\lambda()</span>). <!-- Subscripts $i,s$ are included for generality, allowing individual and temporal variation in detection probability, but more often than not these do not appear in the model ($\theta_{is} = \theta$ for all $i,s$) and $p_k$ is sufficient. --><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./02-example.html" class="pagination-link" aria-label="Simple example">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Simple example</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-theory-area-search.html" class="pagination-link" aria-label="Area search">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Area search</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>