<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>The SECR book - 12&nbsp; Habitat mask</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./13-fittedmodels.html" rel="next">
<link href="./11-density-model.html" rel="prev">
<link href="./images/density6.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script><script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-secr-package.html">Practice</a></li><li class="breadcrumb-item"><a href="./12-habitat.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Habitat mask</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">The SECR book</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/MurrayEfford/SECRbook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foreword</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Concepts and terminology</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Simple example</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Likelihood-based SECR</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-theory-area-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Area search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-theory-special-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Special topics</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Performance</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Assumptions and robustness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Empirical validation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-studydesign.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Study design</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Practice</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-secr-package.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">R package secr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-detection-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Detection model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-density-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Density model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-habitat.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Habitat mask</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-fittedmodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Working with fitted models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-multisession.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Multiple sessions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-finite-mixtures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Individual heterogeneity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-sex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Sex differences</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Simulation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A01-troubleshooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Troubleshooting <strong>secr</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A02-speed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Faster is better</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A03-spatial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A04-polygondetectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Area and transect search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A05-mark-resight.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Mark-resight models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A06-noneuclidean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Non-Euclidean distances</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A07-telemetry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Telemetry</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A08-parameterizations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Parameterizations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A09-densityappendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Density revisited</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A10-trend.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Trend revisited</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A11-expected-counts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Expected counts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A12-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A99-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
<li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background"><span class="header-section-number">12.1</span> Background</a></li>
  <li><a href="#sec-maskwhatfor" id="toc-sec-maskwhatfor" class="nav-link" data-scroll-target="#sec-maskwhatfor"><span class="header-section-number">12.2</span> What is a mask for?</a></li>
  <li><a href="#masks-in-secr" id="toc-masks-in-secr" class="nav-link" data-scroll-target="#masks-in-secr"><span class="header-section-number">12.3</span> Masks in <strong>secr</strong></a></li>
  <li><a href="#sec-bufferwidth" id="toc-sec-bufferwidth" class="nav-link" data-scroll-target="#sec-bufferwidth"><span class="header-section-number">12.4</span> How wide should the buffer be?</a></li>
  <li><a href="#sec-maskspacing" id="toc-sec-maskspacing" class="nav-link" data-scroll-target="#sec-maskspacing"><span class="header-section-number">12.5</span> Grid cell size</a></li>
  <li><a href="#excluding-non-habitat" id="toc-excluding-non-habitat" class="nav-link" data-scroll-target="#excluding-non-habitat"><span class="header-section-number">12.6</span> Excluding non-habitat</a></li>
  <li><a href="#mask-covariates" id="toc-mask-covariates" class="nav-link" data-scroll-target="#mask-covariates"><span class="header-section-number">12.7</span> Mask covariates</a></li>
  <li><a href="#regional-population-size" id="toc-regional-population-size" class="nav-link" data-scroll-target="#regional-population-size"><span class="header-section-number">12.8</span> Regional population size</a></li>
  <li><a href="#plotting-masks" id="toc-plotting-masks" class="nav-link" data-scroll-target="#plotting-masks"><span class="header-section-number">12.9</span> Plotting masks</a></li>
  <li><a href="#more-on-creating-and-manipulating-masks" id="toc-more-on-creating-and-manipulating-masks" class="nav-link" data-scroll-target="#more-on-creating-and-manipulating-masks"><span class="header-section-number">12.10</span> More on creating and manipulating masks</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-secr-package.html">Practice</a></li><li class="breadcrumb-item"><a href="./12-habitat.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Habitat mask</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-habitat" class="quarto-section-identifier"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Habitat mask</span></span></h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header><p></p>
<p>A mask represents habitat in the vicinity of detectors that is potentially occupied by the species of interest. Understanding habitat masks and how to define and manipulate them is central to spatially explicit capture–recapture. This chapter summarises what users need to know about masks in <strong>secr</strong>. Early sections apply regardless of software.</p>
<section id="background" class="level2" data-number="12.1"><h2 data-number="12.1" class="anchored" data-anchor-id="background">
<span class="header-section-number">12.1</span> Background</h2>
<p>We start with an intuitive explanation of the need for habitat masks. Devices such as traps or cameras record animals moving in a general region. If the devices span a patch of habitat with a known boundary then we use a mask to define that geographical unit. More commonly, detectors are placed in continuous habitat and the boundary of the region sampled is ill-defined. This is because the probability of detecting an animal tapers off gradually with distance.</p>
<p>Vagueness regarding the region sampled is addressed in spatially explicit capture–recapture by considering a larger and more inclusive region, the habitat mask. Its extent is not critical, except that it should be at least large enough to account for all detected animals.</p>
<p>Next we refine this intuitive explanation for each of the dominant methods for fitting SECR models: maximum likelihood and Markov-chain Monte Carlo (MCMC) sampling. Each grapples in a slightly different way with the awkward fact that, although we wish to model detection as a function of distance from the activity centre, the activity centre of each animal is at an unknown location.</p>
<section id="maximum-likelihood-and-the-area-of-integration" class="level3" data-number="12.1.1"><h3 data-number="12.1.1" class="anchored" data-anchor-id="maximum-likelihood-and-the-area-of-integration">
<span class="header-section-number">12.1.1</span> Maximum likelihood and the area of integration</h3>
<p>The likelihood developed for SECR by <span class="citation" data-cites="be08">Borchers &amp; Efford (<a href="A99-references.html#ref-be08" role="doc-biblioref">2008</a>)</span> allows for the unknown centres by numerically integrating them out of the likelihood (crudely, by summing over all possible locations of detected animals, weighting each by a detection probability). Although the integration might, in principle, have infinite spatial bounds, it is practical to restrict attention to a smaller region, the ‘area of integration’. As long as the probability weights get close to zero before we reach the boundary, we don’t need to worry too much about the size of the region.</p>
<p>In <strong>secr</strong> the habitat mask equates to the area of integration: the likelihood is evaluated by summing values across a fine mesh of points. This is the primary function of the habitat mask; we consider other functions in <a href="#sec-maskwhatfor" class="quarto-xref"><span>Section 12.2</span></a>.</p>
</section><section id="mcmc-and-the-bayesian-state-space" class="level3" data-number="12.1.2"><h3 data-number="12.1.2" class="anchored" data-anchor-id="mcmc-and-the-bayesian-state-space">
<span class="header-section-number">12.1.2</span> MCMC and the Bayesian ‘state space’</h3>
<p></p>
<p>MCMC methods for spatial capture–recapture developed by Royle and coworkers <span class="citation" data-cites="rcsg14">(<a href="A99-references.html#ref-rcsg14" role="doc-biblioref">Royle et al., 2014</a>)</span> take a slightly different tack. The activity centres are treated as a large number of unobserved (latent) variables. The MCMC algorithm ‘samples’ from the posterior distribution of location for each animal, whether detected or not. The term ‘state space’ is used for the set of permitted locations; usually this is a continuous (not discretized) rectangular region.</p>
<p></p>
</section></section><section id="sec-maskwhatfor" class="level2" data-number="12.2"><h2 data-number="12.2" class="anchored" data-anchor-id="sec-maskwhatfor">
<span class="header-section-number">12.2</span> What is a mask for?</h2>
<p>Masks serve multiple purposes in addition to the basic one we have just introduced. We distinguish five functions of a habitat mask and there may be more:</p>
<ol type="1">
<li><p>To define the outer limit of the area of integration. Habitat beyond the mask may be occupied, but animals centred there have negligible chance of being detected.</p></li>
<li><p>To facilitate computation. By defining the area of integration as a list of discrete points (the centres of grid cells, each with notionally uniform density) we transform the relatively messy task of numerical integration into the much simpler one of summation.</p></li>
<li><p>To distinguish habitat sites from non-habitat sites within the outer limit. Habitat cells have the potential to be occupied. Treating non-habitat as if it is habitat can cause habitat-specific density to be underestimated.</p></li>
<li><p>To store habitat covariates for spatial models of density. Covariates for modelling a density surface are provided for each point on the mask.</p></li>
<li><p>To define a region for which a post-hoc estimate of population size is required. This may differ from the mask used to fit the model.</p></li>
</ol>
<p>The first point raises the question of where the outer limit should lie (i.e., the buffer width), and the second raises the question of how coarse the discretization (i.e., the cell size) can be without damaging the estimates. Later sections address each of the five points in turn, after an introductory section describing the particular implementation of habitat masks in the R package <strong>secr</strong>.</p>
</section><section id="masks-in-secr" class="level2" data-number="12.3"><h2 data-number="12.3" class="anchored" data-anchor-id="masks-in-secr">
<span class="header-section-number">12.3</span> Masks in <strong>secr</strong>
</h2>
<p>A habitat mask is represented in <strong>secr</strong> by a set of <em>square</em> grid cells. Their combined area may be almost any shape and may include holes. An object of class ‘mask’ is a 2-column dataframe with additional attributes (cell area etc.); each row gives the x- and y-coordinates of the centre of one cell.</p>
<section id="masks-generated-automatically-by-secr.fit" class="level3" data-number="12.3.1"><h3 data-number="12.3.1" class="anchored" data-anchor-id="masks-generated-automatically-by-secr.fit">
<span class="header-section-number">12.3.1</span> Masks generated automatically by <code>secr.fit</code>
</h3>
<p>A mask is used whenever a model is fitted with the function <code>secr.fit</code>, even if none is specified in the ‘mask’ argument. When no mask is provided, one is constructed automatically using the value of the ‘buffer’ argument. For example</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.otago.ac.nz/density/">secr</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/secr/man/secr.fit.html">secr.fit</a></span><span class="op">(</span><span class="va">captdata</span>, buffer <span class="op">=</span> <span class="fl">80</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The mask is saved as a component of the fitted model (‘secr’ object); we can plot it and overlay the traps:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>code to plot automatically generated mask</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">mask</span>, dots <span class="op">=</span> <span class="cn">FALSE</span>, mesh <span class="op">=</span> <span class="st">"grey"</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/traps.html">traps</a></span><span class="op">(</span><span class="va">captdata</span><span class="op">)</span>, detpar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-bufferplot" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-bufferplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="12-habitat_files/figure-html/fig-bufferplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" data-glightbox="description: .lightbox-desc-1"><img src="12-habitat_files/figure-html/fig-bufferplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="336"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bufferplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.1: Mask (grey grid) generated automatically in <code>secr.fit</code> by buffering around the detectors (red dots) (80-m buffer, 30-m detector spacing)
</figcaption></figure>
</div>
</div>
</div>
<p>The mask is generated by forming a grid that extends ‘buffer’ metres north, south, east and west of the detectors and dropping centroids that are more than ‘buffer’ metres from the nearest detector (hence the rounded corners). The obvious question “How wide should the buffer be?” is addressed in a later section. The spacing of mask points (i.e.&nbsp;width of grid cells) is set arbitrarily to 1/64th of the east-west dimension - in this example the spacing is 6.7 metres.</p>
</section><section id="masks-constructed-with-make.mask" class="level3" data-number="12.3.2"><h3 data-number="12.3.2" class="anchored" data-anchor-id="masks-constructed-with-make.mask">
<span class="header-section-number">12.3.2</span> Masks constructed with <code>make.mask</code>
</h3>
<p>A mask may also be prepared in advance and provided to <code>secr.fit</code> in the ‘mask’ argument. This overrides the automatic process of the preceding section, and the value of ‘buffer’ is discarded. The function <code>make.mask</code> provides precise control over the the size of the cells, the extent of the mask, and much more. We introduce <code>make.mask</code> here with a simple example based on a ‘hollow grid’:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hollowgrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/secr/man/make.traps.html">make.grid</a></span><span class="op">(</span>nx <span class="op">=</span> <span class="fl">10</span>, ny <span class="op">=</span> <span class="fl">10</span>, spacing <span class="op">=</span> <span class="fl">30</span>, hollow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hollowmask</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/secr/man/make.mask.html">make.mask</a></span><span class="op">(</span><span class="va">hollowgrid</span>, buffer <span class="op">=</span> <span class="fl">80</span>, spacing <span class="op">=</span> <span class="fl">15</span>, type <span class="op">=</span> <span class="st">"trapbuffer"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>code to plot mask from <code>make.mask</code></summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hollowmask</span>, dots <span class="op">=</span> <span class="cn">FALSE</span>, mesh <span class="op">=</span> <span class="st">"grey"</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hollowgrid</span>, detpar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-simplemakemask" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-simplemakemask-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="12-habitat_files/figure-html/fig-simplemakemask-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" data-glightbox="description: .lightbox-desc-2"><img src="12-habitat_files/figure-html/fig-simplemakemask-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="336"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-simplemakemask-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.2: Mask (grey grid) generated with <code>make.mask</code> (80-m buffer, 30-m trap spacing, 15-m mask spacing). Grid cells in the centre were dropped because they were more than 80 m from any trap.
</figcaption></figure>
</div>
</div>
</div>
<p>We chose a coarser grid (spacing 15 metres) relative to the trap spacing. This, combined with the hole in the centre, results in a mask with many fewer rows (764 rows compared to 3980). Setting the type to “trapbuffer” trims grid cells from the corners and the centre.</p>
<p>If we collected data <code>hollowCH</code> with the hollow grid we could fit a SECR model using <code>hollowmask</code>. For illustration we simulate some data using default settings in <code>sim.capthist</code> (5 occasions, D = 5/ha, g0 = 0.2, sigma = 25 m).</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hollowCH</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/secr/man/sim.capthist.html">sim.capthist</a></span><span class="op">(</span><span class="va">hollowgrid</span>, seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/secr/man/secr.fit.html">secr.fit</a></span><span class="op">(</span><span class="va">hollowCH</span>, mask <span class="op">=</span> <span class="va">hollowmask</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       link estimate SE.estimate      lcl      ucl
D       log   5.0807    1.078535  3.36683  7.66711
g0    logit   0.2047    0.044309  0.13117  0.30497
sigma   log  26.1801    3.241670 20.55772 33.34021</code></pre>
</div>
</div>
<p>Fitting is fast because there are few traps and few mask points. As before, the mask is retained in the output, so –</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Number of rows in hollow mask ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">$</span><span class="va">mask</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of rows in hollow mask = 764 </code></pre>
</div>
</div>
</section></section><section id="sec-bufferwidth" class="level2" data-number="12.4"><h2 data-number="12.4" class="anchored" data-anchor-id="sec-bufferwidth">
<span class="header-section-number">12.4</span> How wide should the buffer be?</h2>
<p></p>
<p>The general answer is ‘Wide enough that any bias in estimated densities is negligible’. Excessive truncation of the mask results in positive bias that depends on the sampling regime (detector layout and sampling duration) and the detection function, particularly its spatial scale and shape.</p>
<p>The penalty for using an over-wide buffer is that fitting will be slower for a given mask spacing. <em>It is usually smart to accept this penalty rather than search for the narrowest acceptable buffer.</em></p>
<p>Two factors are critical when selecting a buffer width –</p>
<ol type="1">
<li>The spatial scale of detection, which is usually a function of home-range movements.</li>
<li>The shape of the detection function, particularly the length of its tail.</li>
</ol>
<p>These must be considered together. The following comments assume the default half-normal detection function, which has a short tail and spatial scale parameter <span class="math inline">\sigma_{HN}</span>, unless stated otherwise.</p>
<section id="a-rule-of-thumb-for-buffer-width" class="level3" data-number="12.4.1"><h3 data-number="12.4.1" class="anchored" data-anchor-id="a-rule-of-thumb-for-buffer-width">
<span class="header-section-number">12.4.1</span> A rule of thumb for buffer width</h3>
<p>As a rule of thumb, a buffer of <span class="math inline">4\sigma_{HN}</span> is likely to be adequate (result in truncation bias of less than 0.1%). A pilot estimate of <span class="math inline">\sigma_{HN}</span> may be found for a particular dataset (capthist object) with the function <code>RPSV</code> with the argument ‘CC’ set to TRUE:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/homerange.html">RPSV</a></span><span class="op">(</span><span class="va">captdata</span>, CC <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25.629</code></pre>
</div>
</div>
<p>This is an approximation based on a circular bivariate normal distribution that ignores the truncation of recaptures due to the finite extent of the detector array <span class="citation" data-cites="cc58">(<a href="A99-references.html#ref-cc58" role="doc-biblioref">Calhoun &amp; Casby, 1958</a>)</span>.</p>
</section><section id="buffer-width-for-heavy-tailed-detection-functions" class="level3" data-number="12.4.2"><h3 data-number="12.4.2" class="anchored" data-anchor-id="buffer-width-for-heavy-tailed-detection-functions">
<span class="header-section-number">12.4.2</span> Buffer width for heavy-tailed detection functions</h3>
<p>Heavy-tailed detection functions such as the hazard-rate (HR, HHR) can be problematic because they require an unreasonably large buffer for stable density estimates. They are better avoided unless there is a natural boundary.</p>
</section><section id="hands-free-buffer-selection-suggest.buffer" class="level3" data-number="12.4.3"><h3 data-number="12.4.3" class="anchored" data-anchor-id="hands-free-buffer-selection-suggest.buffer">
<span class="header-section-number">12.4.3</span> Hands-free buffer selection: <code>suggest.buffer</code>
</h3>
<p>The <code>suggest.buffer</code> function is an alternative to the <span class="math inline">4\sigma_{HN}</span> rule of thumb for data from point detectors (not polygon or transect detectors). It has the advantage of allowing for the geometry of the detector array (specifically, the length of edge) and the duration of sampling. The algorithm is obscure and undocumented (this is only a suggestion!) and uses an approximation to the bias, computed by function <code>bias.D</code>. The first argument of <code>suggest.buffer</code> may be a capthist object or a fitted model. With a capthist object as input:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/suggest.buffer.html">suggest.buffer</a></span><span class="op">(</span><span class="va">captdata</span>, detectfn <span class="op">=</span> <span class="st">'HN'</span>, RBtarget <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: using automatic 'detectpar' g0 = 0.2339, sigma = 30.75</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 105</code></pre>
</div>
</div>
<p>When the input is only a capthist object, the suggested buffer width relies on an estimate of <span class="math inline">\sigma_{HN}</span> that is itself biased (RPSV(captdata, CC=TRUE)). <a href="#sec-suggest" class="quarto-xref"><span>Section 12.4.4</span></a> shows how the suggested buffer width changes when we use a better estimate of <span class="math inline">\sigma_{HN}</span>. Actual bias due to mask truncation will also exceed the target (RB = 0.1%) due to limitations of the <em>ad hoc</em> algorithm in <code>bias.D</code>.</p>
</section><section id="sec-suggest" class="level3" data-number="12.4.4"><h3 data-number="12.4.4" class="anchored" data-anchor-id="sec-suggest">
<span class="header-section-number">12.4.4</span> Retrospective buffer checks</h3>
<p>Once a model has been fitted with a particular buffer width or mask, the estimated detection parameters may be used to check whether the buffer width is likely to have resulted in mask truncation bias. We highlight two of these:</p>
<p></p>
<ol type="1">
<li>
<code>secr.fit</code> automatically checks a mask generated from its ‘buffer’ argument (i.e.&nbsp;when the ‘mask’ argument is missing), using <code>bias.D</code> as in <code>suggest.buffer</code>. A warning is given when the predicted truncation bias exceeds a threshold. The threshold is controlled by the ‘biasLimit’ argument (default 0.01). To suppress the check set ‘biasLimit = NA’, or provide a pre-defined mask.</li>
</ol>
<p>The check is performed by a cunning custom algorithm in function <code>bias.D</code>. This uses one-dimensional numerical integration of a polar approximation to site-specific detection probability, coupled to a 3-part linear approximation for the length of contours of distance-to-nearest-detector. The check cannot be performed for some detector types, and the embedded integration can give rise to cryptic error messages.</p>
<p></p>
<ol start="2" type="1">
<li>
<code>esaPlot</code> provides a quick visualisation of the change in estimated density as buffer width changes. It is a handy check on any fitted model, and may also be used with pilot parameter values. The name of the function derives from its reliance on calculation of the <a href="./05-theory-special-topics.html#sec-esa">effective sampling area</a> (esa or <span class="math inline">a(\hat \theta)</span>).</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/secr/man/secr.fit.html">secr.fit</a></span><span class="op">(</span><span class="va">captdata</span>, buffer <span class="op">=</span> <span class="fl">100</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>pty <span class="op">=</span> <span class="st">"s"</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, mgp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.5</span>,<span class="fl">0.8</span>,<span class="fl">0</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/esaPlot.html">esaPlot</a></span><span class="op">(</span><span class="va">fit</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">4</span> <span class="op">*</span> <span class="fl">25.6</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-habitatesaplot" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-habitatesaplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="12-habitat_files/figure-html/fig-habitatesaplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" data-glightbox="description: .lightbox-desc-3"><img src="12-habitat_files/figure-html/fig-habitatesaplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="336"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-habitatesaplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.3: Effect of varying buffer width on estimated density (y-axis). Vertical line indicates rule-of-thumb buffer width.
</figcaption></figure>
</div>
</div>
</div>
<p>The esa plot supports the prediction that increasing buffer width beyond the rule-of-thumb value has no discernable effect on the estimated density (<a href="#fig-habitatesaplot" class="quarto-xref">Fig.&nbsp;<span>12.3</span></a>).</p>
<p>The function <code>mask.check</code> examines the effect of buffer width and mask spacing (cell size) by computing the likelihood or re-fitting an entire model. The function generates either the log likelihood or the estimated density for each cell in a matrix where rows correspond to different buffer widths and columns correspond to different mask spacings. The function is limited to single-session models and is slow compared to <code>esaPlot</code>. See <code><a href="https://rdrr.io/pkg/secr/man/mask.check.html">?mask.check</a></code> for more.</p>
<p>Note also that <code>suggest.buffer</code> may be used retrospectively (with a fitted model as input), and</p>
<div class="cell" data-fig.capt="">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/suggest.buffer.html">suggest.buffer</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100</code></pre>
</div>
</div>
<p>which is coincidental, but encouraging!</p>
</section><section id="buffer-using-non-euclidean-distances" class="level3" data-number="12.4.5"><h3 data-number="12.4.5" class="anchored" data-anchor-id="buffer-using-non-euclidean-distances">
<span class="header-section-number">12.4.5</span> Buffer using non-Euclidean distances</h3>
<p>If you intend to use a non-Euclidean distance metric then it makes sense to use this also when defining the mask, specifically to drop mask points that are distant from any detector according to the metric. See <a href="A06-noneuclidean.html" class="quarto-xref"><span>Appendix F</span></a> for an example. Modelling with non-Euclidean distances also requires the user to provide <code>secr.fit</code> with a matrix of user-computed distances between detectors and mask points.</p>
</section></section><section id="sec-maskspacing" class="level2" data-number="12.5"><h2 data-number="12.5" class="anchored" data-anchor-id="sec-maskspacing">
<span class="header-section-number">12.5</span> Grid cell size</h2>
<p> </p>
<p>Using a set of discrete locations (mask points) to represent the locations of animals is numerically convenient, and by making grid cells small enough we can certainly eliminate any effect of discretization. However, reducing cell size increases the number of cells and slows down model fitting. Trials with varying cell size (mask spacing) provide reassurance that discretization has not distorted the analysis.</p>
<p>In this section we report results from trials with four very different datasets for which details are given in the <strong>secr</strong> documentation: Maryland ovenbirds (ovenCH), Waitarere possums (possumCH), Arizona horned lizards (hornedlizardCH) and Tennessee black bears (blackbearCH). These studies used respectively mist nets, cage trapping, area search and DNA identification of hairs from barbed wire snares.</p>
<p>The reference scale was <span class="math inline">\sigma</span> estimated earlier by fitting a half-normal detection model. In each case masks were constructed with constant buffer width <span class="math inline">4\sigma</span> and different spacings in the range <span class="math inline">0.2\sigma</span> to <span class="math inline">3\sigma</span>. This resulted in widely varying numbers of mask points (<a href="#fig-maskpoints" class="quarto-xref">Fig.&nbsp;<span>12.4</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-maskpoints" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-maskpoints-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/maskrows.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" data-glightbox="description: .lightbox-desc-4"><img src="figures/maskrows.png" class="img-fluid figure-img" style="width:60.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-maskpoints-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.4: Effect of mask spacing on number of mask points for four test datasets. Detector configurations varied: a single searched square (horned lizards), a single elongated hollow grid of mistnets (ovenbirds), multiple hollow grids of cage traps (Waitarere possums), hair snares along a dense irregular network of trails (black bears).
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-maskspacing" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-maskspacing-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/maskspacing.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" data-glightbox="description: .lightbox-desc-5"><img src="figures/maskspacing.png" class="img-fluid figure-img" style="width:90.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-maskspacing-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.5: Effect of mask spacing on estimates of density from null model. Bias is relative to the estimate using the narrowest spacing. The Arizona horned lizard data appeared especially robust to mask spacing, which may be due to the method (search of a large contiguous area) or duration (14 sampling occasions) <span class="citation" data-cites="ry08">(<a href="A99-references.html#ref-ry08" role="doc-biblioref">Royle &amp; Young, 2008</a>)</span>.
</figcaption></figure>
</div>
</div>
</div>
<p>The results in <a href="#fig-maskspacing" class="quarto-xref">Fig.&nbsp;<span>12.5</span></a> suggest that, for a uniform density model, any mask spacing less than the half-normal <span class="math inline">\sigma</span> is adequate; <span class="math inline">0.6\sigma</span> provides a considerable safety margin. The effect of detector spacing on the relationship has not been examined. Referring back to <a href="#fig-maskpoints" class="quarto-xref">Fig.&nbsp;<span>12.4</span></a>, a mask of about 1000 points will usually be adequate with a <span class="math inline">4\sigma</span> buffer.</p>
<p>The default spacing in <code>secr.fit</code> and <code>make.mask</code> is determined by dividing the x-dimension of the buffered area by 64. The resulting mask typically has about 4000 points, which is overkill. Substantial improvements in speed can be obtained with coarser masks, obtained by reducing ‘nx’ or ‘spacing’ arguments of <code>make.mask</code>.</p>
<p>For completeness, we revisit the question of buffer width using the <code>esaPlot</code> function with each of the four test datasets (<a href="#fig-bufferbias" class="quarto-xref">Fig.&nbsp;<span>12.6</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-bufferbias" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-bufferbias-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/maskesa.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" data-glightbox="description: .lightbox-desc-6"><img src="figures/maskesa.png" class="img-fluid figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bufferbias-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.6: Approximate relative bias due to mask truncation for four datasets. Bias is relative to the estimate using the widest buffer.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="excluding-non-habitat" class="level2" data-number="12.6"><h2 data-number="12.6" class="anchored" data-anchor-id="excluding-non-habitat">
<span class="header-section-number">12.6</span> Excluding non-habitat</h2>
<p></p>
<p>Our focus so far has been on choosing a buffer width to set the outer boundary of a habitat mask, assuming that the actual boundary is arbitrary. We can call these ‘masks of convenience’ (<a href="#fig-masktypes" class="quarto-xref">Fig.&nbsp;<span>12.7</span></a> a); numerical accuracy and computation speed are the only constraints. At the other extreme, a mask may represent a natural island of habitat surrounded by non-habitat (<a href="#fig-masktypes" class="quarto-xref">Fig.&nbsp;<span>12.7</span></a> c). A geographical map, possibly in the form of an ESRI shapefile, is then sufficient to define the mask. Between these extremes there are may be a habitat mosaic including both some non-habitat near the detectors and some habitat further away, so neither the buffered mask of convenience nor the habitat island is a good match (<a href="#fig-masktypes" class="quarto-xref">Fig.&nbsp;<span>12.7</span></a> b).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-masktypes" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-masktypes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/masktypes.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" data-glightbox="description: .lightbox-desc-7"><img src="figures/masktypes.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-masktypes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.7: Types of habitat mask (grey mesh) defined in relation to habitat (green) and detectors (red dots). (a) mask of convenience defined by a buffer around detectors in continuous habitat, (b) mask of convenience excluding non-habitat (c) fully sampled habitat island.
</figcaption></figure>
</div>
</div>
</div>
<p>The virtue of clipping non-habitat is that the estimate of density then relates to the area of habitat rather than the sum of habitat and non-habitat. For most uses habitat-based density would seem the more meaningful parameter.</p>
<p>Exclusion of non-habitat (<a href="#fig-masktypes" class="quarto-xref">Fig.&nbsp;<span>12.7</span></a> b,c) is achieved by providing <code>make.mask</code> with a digital map of the habitat in the ‘poly’ argument. The digital map may be an R object defining spatial polygons as described in <a href="A03-spatial-data.html" class="quarto-xref"><span>Appendix C</span></a>, or simply a 2-column matrix or dataframe of coordinates. This simple example uses the coordinates in <code>possumarea</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clippedmask</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/secr/man/make.mask.html">make.mask</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/traps.html">traps</a></span><span class="op">(</span><span class="va">possumCH</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'trapbuffer'</span>, buffer <span class="op">=</span> <span class="fl">400</span>, </span>
<span>                        poly <span class="op">=</span> <span class="va">possumarea</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>code to plot clipped mask</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">clippedmask</span>, border <span class="op">=</span> <span class="fl">100</span>, ppoly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span><span class="va">possumarea</span>, col <span class="op">=</span> <span class="st">'lightgreen'</span>, border <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">clippedmask</span>, dots <span class="op">=</span> <span class="cn">FALSE</span>, mesh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span><span class="op">(</span><span class="fl">0.4</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>, polycol <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/traps.html">traps</a></span><span class="op">(</span><span class="va">possumCH</span><span class="op">)</span>, detpar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>, </span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-plotpossummask" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-plotpossummask-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="12-habitat_files/figure-html/fig-plotpossummask-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" data-glightbox="description: .lightbox-desc-8"><img src="12-habitat_files/figure-html/fig-plotpossummask-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plotpossummask-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.8: Mask computed by clipping to a polygon – the shoreline of the ‘peninsula’ at Waitarere separating the Tasman Sea (left) from the estuary of the Manawatu River (right).
</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>By default, data for the ‘poly’ argument are retained as an attribute of the mask. With some data sources this grossly inflates the size of the mask, and it is better to discard the attribute with <code>keep.poly = FALSE</code>.</p>
</div>
</div>
</section><section id="mask-covariates" class="level2" data-number="12.7"><h2 data-number="12.7" class="anchored" data-anchor-id="mask-covariates">
<span class="header-section-number">12.7</span> Mask covariates</h2>
<p></p>
<p>Masks may have a ‘covariates’ attribute that is a dataframe just like the ‘covariates’ attributes of traps and capthist objects. The data frame has one row for each row (point) on the mask, and one column for each covariate. The dataframe may include unused columns. Mask covariates are used for modelling [density surfaces] (D), not for modelling detection parameters (g0, lambda0, sigma).</p>
<p>Covariates may be categorical (factor-valued) or continuous. Character-valued covariates will be coerced to factors. Covariates in detection models ideally take a small number of discrete values, but there is no such constraint on mask covariates, which may be continuous.</p>
<section id="adding-covariates" class="level3" data-number="12.7.1"><h3 data-number="12.7.1" class="anchored" data-anchor-id="adding-covariates">
<span class="header-section-number">12.7.1</span> Adding covariates</h3>
<p>Mask covariates are always added after a mask is first constructed. Extending the earlier example, we can add a covariate for the computed distance to shore:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/covariates.html">covariates</a></span><span class="op">(</span><span class="va">clippedmask</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>d.to.shore <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/secr/man/distancetotrap.html">distancetotrap</a></span><span class="op">(</span><span class="va">clippedmask</span>, <span class="va">possumarea</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function <code>addCovariates</code> makes it easy to extract data for each mask cell from a spatial data source. Its usage is</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/addCovariates.html">addCovariates</a></span> <span class="op">(</span><span class="va">object</span>, <span class="va">spatialdata</span>, columns <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    strict <span class="op">=</span> <span class="cn">FALSE</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Values are extracted for the point in the data source corresponding to the centre point of each grid cell. The spatial data source (<code>spatialdata</code>) should be one of</p>
<ul>
<li>ESRI polygon shapefile name (excluding .shp)</li>
<li>sf spatial object, package <a href="https://CRAN.R-project.org/package=sf">sf</a>
</li>
<li>RasterLayer, package <a href="https://CRAN.R-project.org/package=raster">raster</a>
</li>
<li>SpatRaster, package <a href="https://CRAN.R-project.org/package=terra">terra</a>
</li>
<li>SpatialPolygonsDataFrame, package <a href="https://CRAN.R-project.org/package=sp">sp</a>
</li>
<li>SpatialGridDataFrame, package <a href="https://CRAN.R-project.org/package=sp">sp</a>
</li>
<li>another mask with covariates</li>
<li>a traps object with covariates</li>
</ul>
<p>One or more input columns may be selected by name. The argument ‘strict’ generates a warning if points lie outside a mask used as a spatial data source. <a href="A03-spatial-data.html" class="quarto-xref"><span>Appendix C</span></a> has more about spatial data in <strong>secr</strong>.</p>
<p>See <a href="11-density-model.html" class="quarto-xref"><span>Chapter 11</span></a> for further applications, including smooths to represent the <a href="./11-density-model.html#sec-scaleofeffect">scale of effect</a>.</p>
</section><section id="repairing-missing-values" class="level3" data-number="12.7.2"><h3 data-number="12.7.2" class="anchored" data-anchor-id="repairing-missing-values">
<span class="header-section-number">12.7.2</span> Repairing missing values</h3>
<p>Covariate values become NA for points not in the data source for addCovariates. Modelling will fail until a valid value is provided for every mask point (ignoring covariates not used in models). If only a few values are missing at only a few points it is usually acceptable to interpolate them from surrounding non-missing values. For continuous covariates we suggest linear interpolation with the function <code>interp</code> in the <strong>akima</strong> package <span class="citation" data-cites="R-akima">(<a href="A99-references.html#ref-R-akima" role="doc-biblioref">Akima &amp; Gebhardt, 2022</a>)</span>. The following short function provides an interface:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">repair</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">mask</span>, <span class="va">covariate</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">NAcov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/covariates.html">covariates</a></span><span class="op">(</span><span class="va">mask</span><span class="op">)</span><span class="op">[</span>,<span class="va">covariate</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">OK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">mask</span>, <span class="op">!</span><span class="va">NAcov</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">akima</span><span class="op">)</span></span>
<span>    <span class="va">irect</span> <span class="op">&lt;-</span> <span class="fu">akima</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/akima/man/interp.html">interp</a></span> <span class="op">(</span>x <span class="op">=</span> <span class="va">OK</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">OK</span><span class="op">$</span><span class="va">y</span>, z <span class="op">=</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/secr/man/covariates.html">covariates</a></span><span class="op">(</span><span class="va">OK</span><span class="op">)</span><span class="op">[</span>,<span class="va">covariate</span><span class="op">]</span>,<span class="va">...</span><span class="op">)</span></span>
<span>    <span class="va">irectxy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">irect</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">irect</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/secr/man/distancetotrap.html">nearesttrap</a></span><span class="op">(</span><span class="va">mask</span><span class="op">[</span><span class="va">NAcov</span>,<span class="op">]</span>, <span class="va">irectxy</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/secr/man/covariates.html">covariates</a></span><span class="op">(</span><span class="va">mask</span><span class="op">)</span><span class="op">[</span>,<span class="va">covariate</span><span class="op">]</span><span class="op">[</span><span class="va">NAcov</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">irect</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">mask</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To demonstrate <code>repair</code> we deliberately remove a swathe of covariate values from a copy of our clippedmask and then attempt to interpolate them (<a href="#fig-fillindemo" class="quarto-xref">Fig.&nbsp;<span>12.9</span></a>):</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">damagedmask</span> <span class="op">&lt;-</span> <span class="va">clippedmask</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/covariates.html">covariates</a></span><span class="op">(</span><span class="va">damagedmask</span><span class="op">)</span><span class="op">$</span><span class="va">d.to.shore</span><span class="op">[</span><span class="fl">500</span><span class="op">:</span><span class="fl">1000</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">repaired</span> <span class="op">&lt;-</span> <span class="fu">repair</span><span class="op">(</span><span class="va">damagedmask</span>, <span class="st">'d.to.shore'</span>, nx<span class="op">=</span><span class="fl">60</span>, ny<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The interpolation may potentially be improved by varying the <code>interp</code> arguments nx and ny (passed via the … argument of <code>repair</code>). Although extrapolation is available (with linear = FALSE, extrap = TRUE) it did not work in this case, and there remain some unfilled cells (<a href="#fig-fillindemo" class="quarto-xref">Fig.&nbsp;<span>12.9</span></a> c).</p>
<p>Categorical covariates pose a larger problem. Simply copying the closest valid value may suffice to allow modelling to proceed, and this is a good solution for the few NA cells in <a href="#fig-fillindemo" class="quarto-xref">Fig.&nbsp;<span>12.9</span></a> c.&nbsp;The result should always be checked visually by plotting the covariate: strange patterns may result.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">copynearest</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">mask</span>, <span class="va">cov</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">NAcov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/covariates.html">covariates</a></span><span class="op">(</span><span class="va">mask</span><span class="op">)</span><span class="op">[</span>,<span class="va">cov</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">OK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">mask</span>, <span class="op">!</span><span class="va">NAcov</span><span class="op">)</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/secr/man/distancetotrap.html">nearesttrap</a></span><span class="op">(</span><span class="va">mask</span>, <span class="va">OK</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/secr/man/covariates.html">covariates</a></span><span class="op">(</span><span class="va">mask</span><span class="op">)</span><span class="op">[</span>,<span class="va">cov</span><span class="op">]</span><span class="op">[</span><span class="va">NAcov</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/secr/man/covariates.html">covariates</a></span><span class="op">(</span><span class="va">OK</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">[</span><span class="va">NAcov</span><span class="op">]</span>,<span class="va">cov</span><span class="op">]</span></span>
<span>    <span class="va">mask</span></span>
<span><span class="op">}</span></span>
<span><span class="va">completed</span> <span class="op">&lt;-</span> <span class="fu">copynearest</span><span class="op">(</span><span class="va">repaired</span>, <span class="st">'d.to.shore'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-fillindemo" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-fillindemo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="12-habitat_files/figure-html/fig-fillindemo-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" data-glightbox="description: .lightbox-desc-9"><img src="12-habitat_files/figure-html/fig-fillindemo-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="624"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fillindemo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.9: Interpolation of missing values in mask covariate (artificial example). (a) True coverage, (b) Swathe of missing values, (c) Repaired by linear interpolation. Cells in the west and east that lie outside the convex hull of non-missing points are not interpolated and remain missing, (d) repair completed by filling remaining NA cells with value from nearest non-missing cell.
</figcaption></figure>
</div>
</div>
</div>
<p>See <a href="11-density-model.html" class="quarto-xref"><span>Chapter 11</span></a> for more on the use of mask covariates.</p>
</section></section><section id="regional-population-size" class="level2" data-number="12.8"><h2 data-number="12.8" class="anchored" data-anchor-id="regional-population-size">
<span class="header-section-number">12.8</span> Regional population size</h2>
<p></p>
<p>Population density <span class="math inline">D</span> is the primary parameter in this implementation of spatially explicit capture–recapture (SECR). The number of individuals (population size <span class="math inline">N(A)</span>) is treated as a derived parameter. The rationale for this is that population size is ill-defined in many classical sampling scenarios in continuous habitat (Figs. 7a,b). Population size is well-defined for a habitat island (<a href="#fig-masktypes" class="quarto-xref">Fig.&nbsp;<span>12.7</span></a> c). Population size may also be well-defined for a persistent swarm, colony, herd, pack or flock, although group living is incompatible with the usual SECR assumption of independence e.g. <span class="citation" data-cites="Bischof2020">Bischof et al. (<a href="A99-references.html#ref-Bischof2020" role="doc-biblioref">2020</a>)</span>.</p>
<p>Population size on a habitat island <span class="math inline">A</span> may be derived from an SECR model by the simple calculation <span class="math inline">\hat N = \hat D|A|</span> if density is uniform. The same calculation yields the expected population in any area <span class="math inline">A^\prime</span>. Calculations get more tricky if density is not uniform as then <span class="math inline">\hat N = \int_{A^\prime} D(\mathbf x) \, d\mathbf x</span> (computing the volume under the density surface) <span class="citation" data-cites="ef13">(<a href="A99-references.html#ref-ef13" role="doc-biblioref">Efford &amp; Fewster, 2013</a>)</span>. <strong>secr</strong> provides the function <code>region.N</code> for this purpose (<a href="13-fittedmodels.html#sec-regionN" class="quarto-xref"><span>Section 13.5</span></a>).</p>
</section><section id="plotting-masks" class="level2" data-number="12.9"><h2 data-number="12.9" class="anchored" data-anchor-id="plotting-masks">
<span class="header-section-number">12.9</span> Plotting masks</h2>
<p>The default plot of a mask shows each point as a grey dot. We have used <code>dots = FALSE</code> throughout this document to emphasise the gridcell structure. That is especially handy when we use the plot method to display mask covariates:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">6</span><span class="op">)</span>, xpd <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">clippedmask</span>, covariate <span class="op">=</span> <span class="st">'d.to.shore'</span>, dots <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>    border<span class="op">=</span><span class="fl">100</span>, title <span class="op">=</span> <span class="st">'Distance to shore m'</span>, polycol <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/plotmaskedge.html">plotMaskEdge</a></span><span class="op">(</span><span class="va">clippedmask</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-plotmask" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-plotmask-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="12-habitat_files/figure-html/fig-plotmask-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" data-glightbox="description: .lightbox-desc-10"><img src="12-habitat_files/figure-html/fig-plotmask-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="624"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plotmask-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.10: Plot of a computed continuous covariate across a clipped mask, with outer margin.
</figcaption></figure>
</div>
</div>
</div>
<p>The legend may be suppressed with <code>legend = FALSE</code>. See <code><a href="https://rdrr.io/pkg/secr/man/plot.mask.html">?plot.mask</a></code> for details. We used <code>plotMaskEdge</code> to add a line around the perimeter.</p>
</section><section id="more-on-creating-and-manipulating-masks" class="level2" data-number="12.10"><h2 data-number="12.10" class="anchored" data-anchor-id="more-on-creating-and-manipulating-masks">
<span class="header-section-number">12.10</span> More on creating and manipulating masks</h2>
<section id="arguments-of-make.mask" class="level3" data-number="12.10.1"><h3 data-number="12.10.1" class="anchored" data-anchor-id="arguments-of-make.mask">
<span class="header-section-number">12.10.1</span> Arguments of <code>make.mask</code>
</h3>
<p>The usage statement for <code>make.mask</code> is included as a reminder of various options and defaults that have not been covered in this vignette. See <code><a href="https://rdrr.io/pkg/secr/man/make.mask.html">?make.mask</a></code> for details.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/make.mask.html">make.mask</a></span> <span class="op">(</span><span class="va">traps</span>, buffer <span class="op">=</span> <span class="fl">100</span>, spacing <span class="op">=</span> <span class="cn">NULL</span>, nx <span class="op">=</span> <span class="fl">64</span>, ny <span class="op">=</span> <span class="fl">64</span>,</span>
<span>    type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"traprect"</span>, <span class="st">"trapbuffer"</span>, <span class="st">"pdot"</span>, <span class="st">"polygon"</span>, </span>
<span>    <span class="st">"clusterrect"</span>, <span class="st">"clusterbuffer"</span>, <span class="st">"rectangular"</span>, <span class="st">"polybuffer"</span><span class="op">)</span>,</span>
<span>    poly <span class="op">=</span> <span class="cn">NULL</span>, poly.habitat <span class="op">=</span> <span class="cn">TRUE</span>, cell.overlap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"centre"</span>,</span>
<span>    <span class="st">"any"</span>, <span class="st">"all"</span><span class="op">)</span>, keep.poly <span class="op">=</span> <span class="cn">TRUE</span>, check.poly <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>    pdotmin <span class="op">=</span> <span class="fl">0.001</span>, random.origin <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="mask-attributes-saved-by-make.mask" class="level3" data-number="12.10.2"><h3 data-number="12.10.2" class="anchored" data-anchor-id="mask-attributes-saved-by-make.mask">
<span class="header-section-number">12.10.2</span> Mask attributes saved by <code>make.mask</code>
</h3>
<p>Mask objects generated by <code>make.mask</code> include several attributes not usually on view. Use <code>str</code> to reveal them. Three are simply saved copies of the arguments ‘polygon’, ‘poly.habitat’ and ‘type’, and ‘covariates’ has been discussed already.</p>
<p>The attribute ‘spacing’ is the distance in metres between adjacent grid cell centres in either x- or y- directions.</p>
<p>The attribute ‘area’ is the area of a single grid cell in hectares (1 ha = 10000 m<sup>2</sup>, so area = spacing<sup>2</sup> / 10000; retrieve with <code>attr(mask, 'area')</code>). Use the function <code>maskarea</code> to find the total area of all mask cells; for example, here is the area in hectares of the clipped Waitarere possum mask.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/secr/man/utility.html">maskarea</a></span><span class="op">(</span><span class="va">clippedmask</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 205.06</code></pre>
</div>
</div>
<p>The attribute ‘boundingbox’ is a 2-column dataframe with the x- and y-coordinates of the corners of the smallest rectangle containing all grid cells.</p>
<p>The attribute ‘meanSD’ is a 2-column dataframe with the means and standard deviations of the x- and y-coordinates. These are used to standardize the coordinates if they appear directly in a model formula (e.g., D ~ x + y).</p>
</section><section id="linear-habitat" class="level3" data-number="12.10.3"><h3 data-number="12.10.3" class="anchored" data-anchor-id="linear-habitat">
<span class="header-section-number">12.10.3</span> Linear habitat</h3>
<p>Models for data from linear habitats analysed in the package <strong>secrlinear</strong> <span class="citation" data-cites="R-secrlinear">(<a href="A99-references.html#ref-R-secrlinear" role="doc-biblioref">Efford, 2024</a>)</span> use the class ‘linearmask’ that inherits from ‘mask’. Linear masks have additional attributes ‘SLDF’ and ‘graph’ to describe linear habitat networks. See [secrlinear-vignette.pdf] for details.</p>
</section><section id="dropping-points-from-a-mask" class="level3" data-number="12.10.4"><h3 data-number="12.10.4" class="anchored" data-anchor-id="dropping-points-from-a-mask">
<span class="header-section-number">12.10.4</span> Dropping points from a mask</h3>
<p>If the mask you want cannot be obtained directly with <code>make.mask</code> then use either <code>subset</code> (batch) or <code>deleteMaskPoints</code> (interactive; unreliable in RStudio). This ensures that the attributes are updated properly. Do not simply extract the required points from the mask dataframe by subscripting (<code>[</code>).</p>
</section><section id="multi-session-masks" class="level3" data-number="12.10.5"><h3 data-number="12.10.5" class="anchored" data-anchor-id="multi-session-masks">
<span class="header-section-number">12.10.5</span> Multi-session masks</h3>
<p>Fitting a SECR model to a multi-session capthist requires a mask for each session. If a single mask is passed to <code>secr.fit</code> then it will be replicated and must be appropriate for all sessions. The alternative is to provide a list of masks, one per session, in the correct order; <code>make.mask</code> generates such a list from a list of traps objects. See <a href="14-multisession.html" class="quarto-xref"><span>Chapter 14</span></a> for details.</p>
</section><section id="artificial-habitat-maps" class="level3" data-number="12.10.6"><h3 data-number="12.10.6" class="anchored" data-anchor-id="artificial-habitat-maps">
<span class="header-section-number">12.10.6</span> Artificial habitat maps</h3>
<p>Function <code>randomHabitat</code> generates somewhat realistic maps of habitat that may be used in simulations. It assigns mask pixels to ‘habitat’ and ‘non-habitat’ according to an algorithm that clusters habitat cells together. The classification is saved as a covariate in the output mask, from which non-habitat cells may be dropped entirely (this was used to generate the green habitat background in <a href="#fig-masktypes" class="quarto-xref">Fig.&nbsp;<span>12.7</span></a> b).</p>
</section><section id="mask-vs-raster" class="level3" data-number="12.10.7"><h3 data-number="12.10.7" class="anchored" data-anchor-id="mask-vs-raster">
<span class="header-section-number">12.10.7</span> Mask vs raster</h3>
<p>Mask objects have a lot in common with objects of the RasterLayer S4 class defined in the package <strong>raster</strong> <span class="citation" data-cites="R-raster">(<a href="A99-references.html#ref-R-raster" role="doc-biblioref">Hijmans, 2023a</a>)</span> and the SpatRaster class defined in the package <strong>terra</strong> <span class="citation" data-cites="R-terra">(<a href="A99-references.html#ref-R-terra" role="doc-biblioref">Hijmans, 2023b</a>)</span>. However, they are much simpler: no projection is specified and grid cells must be square.</p>
<p>A mask object may be exported as a RasterLayer using the <code>raster</code> method defined in <strong>secr</strong> for mask objects. This allows you to nominate a covariate to provide values for the RasterLayer, and to specify a projection.</p>
<p>A mask object may also be exported as a SpatRaster using the <code>rast</code> method defined in <strong>secr</strong> for mask objects. See <a href="./11-density-model.html#sec-scaleofeffect">here</a> for an example in which <strong>terra</strong> functions are used to smooth a mask covariate before returning it to the mask.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Inappropriate mask spacing is a common source of problems. Model fitting can be painfully slow if the mask has too many cells. Choose the spacing (cell size) as described in <a href="#sec-maskspacing">Grid cell size</a>. A single mask for widely scattered clusters of traps should drop cells from wide inter-cluster spaces (set ‘type = trapbuffer’).</p>
</div>
</div>


<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">Figure&nbsp;12.1: Mask (grey grid) generated automatically in <code>secr.fit</code> by buffering around the detectors (red dots) (80-m buffer, 30-m detector spacing)</span>
<span class="glightbox-desc lightbox-desc-2">Figure&nbsp;12.2: Mask (grey grid) generated with <code>make.mask</code> (80-m buffer, 30-m trap spacing, 15-m mask spacing). Grid cells in the centre were dropped because they were more than 80 m from any trap.</span>
<span class="glightbox-desc lightbox-desc-3">Figure&nbsp;12.3: Effect of varying buffer width on estimated density (y-axis). Vertical line indicates rule-of-thumb buffer width.</span>
<span class="glightbox-desc lightbox-desc-4">Figure&nbsp;12.4: Effect of mask spacing on number of mask points for four test datasets. Detector configurations varied: a single searched square (horned lizards), a single elongated hollow grid of mistnets (ovenbirds), multiple hollow grids of cage traps (Waitarere possums), hair snares along a dense irregular network of trails (black bears).</span>
<span class="glightbox-desc lightbox-desc-5">Figure&nbsp;12.5: Effect of mask spacing on estimates of density from null model. Bias is relative to the estimate using the narrowest spacing. The Arizona horned lizard data appeared especially robust to mask spacing, which may be due to the method (search of a large contiguous area) or duration (14 sampling occasions) <span class="citation" data-cites="ry08">(<a href="A99-references.html#ref-ry08" role="doc-biblioref">Royle &amp; Young, 2008</a>)</span>.</span>
<span class="glightbox-desc lightbox-desc-6">Figure&nbsp;12.6: Approximate relative bias due to mask truncation for four datasets. Bias is relative to the estimate using the widest buffer.</span>
<span class="glightbox-desc lightbox-desc-7">Figure&nbsp;12.7: Types of habitat mask (grey mesh) defined in relation to habitat (green) and detectors (red dots). (a) mask of convenience defined by a buffer around detectors in continuous habitat, (b) mask of convenience excluding non-habitat (c) fully sampled habitat island.</span>
<span class="glightbox-desc lightbox-desc-8">Figure&nbsp;12.8: Mask computed by clipping to a polygon – the shoreline of the ‘peninsula’ at Waitarere separating the Tasman Sea (left) from the estuary of the Manawatu River (right).</span>
<span class="glightbox-desc lightbox-desc-9">Figure&nbsp;12.9: Interpolation of missing values in mask covariate (artificial example). (a) True coverage, (b) Swathe of missing values, (c) Repaired by linear interpolation. Cells in the west and east that lie outside the convex hull of non-missing points are not interpolated and remain missing, (d) repair completed by filling remaining NA cells with value from nearest non-missing cell.</span>
<span class="glightbox-desc lightbox-desc-10">Figure&nbsp;12.10: Plot of a computed continuous covariate across a clipped mask, with outer margin.</span>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-R-akima" class="csl-entry" role="listitem">
Akima, H., &amp; Gebhardt, A. (2022). <em><span class="nocase">a</span>kima: Interpolation of irregularly and regularly spaced data</em>. <a href="https://CRAN.R-project.org/package=akima">https://CRAN.R-project.org/package=akima</a>
</div>
<div id="ref-Bischof2020" class="csl-entry" role="listitem">
Bischof, R., Dupont, P., Milleret, C., Chipperfield, J., &amp; Royle, J. A. (2020). Consequences of ignoring group association in spatial capture–recapture analysis. <em>Wildlife Biology</em>, <em>2020</em>(1), 1–10. <a href="https://doi.org/10.2981/wlb.00649">https://doi.org/10.2981/wlb.00649</a>
</div>
<div id="ref-be08" class="csl-entry" role="listitem">
Borchers, D. L., &amp; Efford, M. G. (2008). Spatially explicit maximum likelihood methods for capture-recapture studies. <em>Biometrics</em>, <em>64</em>, 377–385.
</div>
<div id="ref-cc58" class="csl-entry" role="listitem">
Calhoun, J. B., &amp; Casby, J. U. (1958). Calculation of home range and density of small mammals. <em>Public Health Monograph</em>, <em>55</em>.
</div>
<div id="ref-R-secrlinear" class="csl-entry" role="listitem">
Efford, M. G. (2024). <em><span class="nocase">secrlinear: Spatially Explicit Capture-Recapture for Linear Habitats</span></em>. <a href="https://CRAN.R-project.org/package=secrlinear">https://CRAN.R-project.org/package=secrlinear</a>
</div>
<div id="ref-ef13" class="csl-entry" role="listitem">
Efford, M. G., &amp; Fewster, R. M. (2013). Estimating population size by spatially explicit capture-recapture. <em>Oikos</em>, <em>122</em>, 918–928.
</div>
<div id="ref-R-raster" class="csl-entry" role="listitem">
Hijmans, R. J. (2023a). Raster: Geographic data analysis and modeling. In <em>R package version 3.6-26</em>. <a href="https://CRAN.R-project.org/package=raster">https://CRAN.R-project.org/package=raster</a>
</div>
<div id="ref-R-terra" class="csl-entry" role="listitem">
Hijmans, R. J. (2023b). <em>Terra: Spatial data analysis</em>. <a href="https://CRAN.R-project.org/package=terra">https://CRAN.R-project.org/package=terra</a>
</div>
<div id="ref-Kendeigh1944" class="csl-entry" role="listitem">
Kendeigh, S. C. (1944). Measurement of bird populations. <em>Ecological Monographs</em>, <em>14</em>, 67–106. <a href="https://doi.org/10.2307/1961632">https://doi.org/10.2307/1961632</a>
</div>
<div id="ref-rcsg14" class="csl-entry" role="listitem">
Royle, J. A., Chandler, R. B., Sollmann, R., &amp; Gardner, B. (2014). <em>Spatial capture-recapture</em>. Academic Press.
</div>
<div id="ref-ry08" class="csl-entry" role="listitem">
Royle, J. A., &amp; Young, K. V. (2008). A hierarchical model for spatial capture-recapture data. <em>Ecology</em>, <em>89</em>, 2281–2289.
</div>
</div>
</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="./11-density-model.html" class="pagination-link" aria-label="Density model">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Density model</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./13-fittedmodels.html" class="pagination-link" aria-label="Working with fitted models">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Working with fitted models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
 The SECR book. Version 0.0.0.  
  </li>  
    <li class="nav-item">
 &nbsp;&nbsp; Copyright © 2025
  </li>  
</ul>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"openEffect":"zoom","loop":false,"selector":".lightbox","closeEffect":"zoom","descPosition":"bottom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>


</body></html>