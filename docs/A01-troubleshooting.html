<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>The SECR book - Appendix A — Troubleshooting secr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./A02-speed.html" rel="next">
<link href="./17-simulation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script><script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./A01-troubleshooting.html">Appendices</a></li><li class="breadcrumb-item"><a href="./A01-troubleshooting.html"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Troubleshooting <strong>secr</strong></span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">The SECR book</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/MurrayEfford/SECRbook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foreword</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Concepts and terminology</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Simple example</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Likelihood-based SECR</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-theory-area-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Area search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-theory-special-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Special topics</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Performance</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Assumptions and robustness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Empirical validation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-studydesign.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Study design</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Practice</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-secr-package.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">R package secr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-detection-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Detection model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-density-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Density model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-habitat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Habitat mask</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-fittedmodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Working with fitted models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-multisession.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Multiple sessions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-finite-mixtures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Individual heterogeneity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-sex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Sex differences</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Simulation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A01-troubleshooting.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Troubleshooting <strong>secr</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A02-speed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Faster is better</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A03-spatial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A04-polygondetectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Area and transect search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A05-mark-resight.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Mark-resight models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A06-noneuclidean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Non-Euclidean distances</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A07-telemetry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Telemetry</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A08-parameterizations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Parameterizations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A09-densityappendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Density revisited</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A10-trend.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Trend revisited</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A11-expected-counts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Expected counts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A12-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A99-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
<li><a href="#bias-limit-exceeded" id="toc-bias-limit-exceeded" class="nav-link active" data-scroll-target="#bias-limit-exceeded"><span class="header-section-number">A.1</span> Bias limit exceeded</a></li>
  <li><a href="#initial-log-likelihood-na" id="toc-initial-log-likelihood-na" class="nav-link" data-scroll-target="#initial-log-likelihood-na"><span class="header-section-number">A.2</span> Initial log likelihood NA</a></li>
  <li><a href="#variancefailed" id="toc-variancefailed" class="nav-link" data-scroll-target="#variancefailed"><span class="header-section-number">A.3</span> Variance calculation failed</a></li>
  <li><a href="#log-likelihood-becomes-na-or-improbably-large-after-a-few-evaluations" id="toc-log-likelihood-becomes-na-or-improbably-large-after-a-few-evaluations" class="nav-link" data-scroll-target="#log-likelihood-becomes-na-or-improbably-large-after-a-few-evaluations"><span class="header-section-number">A.4</span> Log likelihood becomes NA or improbably large after a few evaluations</a></li>
  <li><a href="#possible-maximization-error-nlm-code-3" id="toc-possible-maximization-error-nlm-code-3" class="nav-link" data-scroll-target="#possible-maximization-error-nlm-code-3"><span class="header-section-number">A.5</span> Possible maximization error: nlm code 3</a></li>
  <li><a href="#possible-maximization-error-nlm-code-4" id="toc-possible-maximization-error-nlm-code-4" class="nav-link" data-scroll-target="#possible-maximization-error-nlm-code-4"><span class="header-section-number">A.6</span> Possible maximization error: nlm code 4</a></li>
  <li><a href="#secr.fit-requests-more-memory-than-is-available" id="toc-secr.fit-requests-more-memory-than-is-available" class="nav-link" data-scroll-target="#secr.fit-requests-more-memory-than-is-available"><span class="header-section-number">A.7</span> <code>secr.fit</code> requests more memory than is available</a></li>
  <li><a href="#covariate-factor-levels-differ-between-sessions" id="toc-covariate-factor-levels-differ-between-sessions" class="nav-link" data-scroll-target="#covariate-factor-levels-differ-between-sessions"><span class="header-section-number">A.8</span> Covariate factor levels differ between sessions</a></li>
  <li><a href="#estimates-depend-on-starting-values" id="toc-estimates-depend-on-starting-values" class="nav-link" data-scroll-target="#estimates-depend-on-starting-values"><span class="header-section-number">A.9</span> Estimates depend on starting values</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./A01-troubleshooting.html">Appendices</a></li><li class="breadcrumb-item"><a href="./A01-troubleshooting.html"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Troubleshooting <strong>secr</strong></span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-troubleshooting" class="quarto-section-identifier">Appendix A — Troubleshooting <strong>secr</strong></span></h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header><p></p>
<p>What could possibly go wrong when fitting spatially explicit capture–recapture models? Quite a lot. This appendix assembles a list of known difficulties with <strong>secr</strong> 5.2, with examples, and suggests some solutions. The scaling of covariates and coordinates was discussed earlier in relation to <a href="./11-density-model.html#sec-density">density surface models</a>.</p>
<section id="bias-limit-exceeded" class="level2" data-number="A.1"><h2 data-number="A.1" class="anchored" data-anchor-id="bias-limit-exceeded">
<span class="header-section-number">A.1</span> Bias limit exceeded</h2>
<p> </p>
<p>Suppose we omitted to specify the buffer argument for the first snowshoe hare model in <a href="02-example.html" class="quarto-xref"><span>Chapter 2</span></a>:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">secr.fit</span> <span class="op">(</span><span class="va">hareCH6</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: using default buffer width 100 m</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: predicted relative bias exceeds 0.01 with buffer = 100</code></pre>
</div>
</div>
<p>The second warning message is clearly a consequence of the first: relying on the 100-m default buffer for an animal as mobile as the snowshoe hare is likely to cause problems. See the advice on choosing the buffer width in <a href="12-habitat.html" class="quarto-xref"><span>Chapter 12</span></a>.</p>
<p>Density is overestimated when the buffer width for a detector array in continuous habitat is too small to encompass the centres of all animals potentially detected. A check for this ‘mask truncation bias’ is performed routinely by <code>secr.fit</code> after fitting a model that uses on the ‘buffer’ argument. It may be avoided by setting <code>biasLimit = NA</code> or providing a pre-computed habitat mask in the ‘mask’ argument.</p>
</section><section id="initial-log-likelihood-na" class="level2" data-number="A.2"><h2 data-number="A.2" class="anchored" data-anchor-id="initial-log-likelihood-na">
<span class="header-section-number">A.2</span> Initial log likelihood NA</h2>
<p></p>
<p>Maximization will fail completely if the likelihood cannot be evaluated at the starting values. This will be obvious with <code>trace = TRUE</code>. Otherwise, the first indication will be a premature end to fitting and a lot of NAs in the estimates.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is common to see occasional NA values among the likelihoods evaluated during maximization. This is not a problem.</p>
</div>
</div>
<p>For an example, this section previously used the default starting values for the dataset <code>infraCH</code> (<em>Oligosoma infrapunctatum</em> skinks sampled with pitfall traps over two 3-occasion sessions labelled ‘6’ and ‘7’). Unfortunately, those now seem to work, so we have to contrive an example by specifying a bad starting value for sigma:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">secr.fit</span><span class="op">(</span><span class="va">infraCH</span>, buffer <span class="op">=</span> <span class="fl">25</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>                trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Checking data 
Preparing detection design matrices 
Preparing density design matrix 
Finding initial parameter values... 
Initial values  D = 282.348, g0 = 0.12788, sigma = 2.87777 
Maximizing likelihood... 
Eval     Loglik        D       g0    sigma 
   1         NA   5.6431  -1.9198   0.6931 
   2         NA   5.6431  -1.9198   0.6931 
   3         NA   5.6431  -1.9198   0.6931 
   4         NA   5.6431  -1.9198   0.6931 
   5         NA   5.6431  -1.9198   0.6931 
   6         NA   5.6437  -1.9198   0.6931 
   7         NA   5.6431  -1.9197   0.6931 
   8         NA   5.6431  -1.9198   0.6932 
   9         NA   5.6443  -1.9198   0.6931 
  10         NA   5.6437  -1.9197   0.6931 
  11         NA   5.6437  -1.9198   0.6932 
  12         NA   5.6431  -1.9196   0.6931 
  13         NA   5.6431  -1.9197   0.6932 
  14         NA   5.6431  -1.9198   0.6933 
Completed in 4.19 seconds at 18:17:36 04 Feb 2025 </code></pre>
</div>
</div>
<p>Unsurprisingly, the problem can be addressed by manually providing a better starting value for sigma:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu">secr.fit</span><span class="op">(</span><span class="va">infraCH</span>, buffer <span class="op">=</span> <span class="fl">25</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, </span>
<span>                 trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The original problem seems to have been due to a discrepancy between the two sessions (try <code>RPSV(infraCH, CC = TRUE)</code>). The default sigma was suitable for the first session and not the second, whereas a larger sigma suits both. Rather than manually providing the starting value we could have directed <code>secr.fit</code> to use the second session for determining starting values:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu">secr.fit</span><span class="op">(</span><span class="va">infraCH</span>, buffer <span class="op">=</span> <span class="fl">25</span>, details <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>autoini <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                 trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="variancefailed" class="level2" data-number="A.3"><h2 data-number="A.3" class="anchored" data-anchor-id="variancefailed">
<span class="header-section-number">A.3</span> Variance calculation failed</h2>
<p></p>
<p>If warnings had not been suppressed in the preceding example we would have seen</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in secr.fit(infraCH, buffer = 25, details = list(autoini = 2), trace =
FALSE): at least one variance calculation failed</code></pre>
</div>
</div>
<p></p>
<p>Examination of the output would reveal missing values for SE, lcl and ucl in both the coefficients and predicted values for g0.</p>
<p>Failure to compute the variance can be a sign that the model is inherently non-identifiable or that the particular dataset is inadequate <span class="citation" data-cites="gvccm04">(e.g., <a href="A99-references.html#ref-gvccm04" role="doc-biblioref">Gimenez et al., 2004</a>)</span>. However, here it is due to a weakness in the default algorithm. Call <code>secr.fit</code> with <code>method = "none"</code> to recompute the variance-covariance matrix using a more sophisticated approach:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit2r</span> <span class="op">&lt;-</span> <span class="fu">secr.fit</span><span class="op">(</span><span class="va">infraCH</span>, buffer <span class="op">=</span> <span class="fl">25</span>, start <span class="op">=</span> <span class="va">fit2</span>, method <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Checking data 
Preparing detection design matrices 
Preparing density design matrix 
Computing Hessian with fdHess in nlme 
   1  -2260.348   5.5124  -2.2366   1.4921 
   2  -2260.355   5.5179  -2.2366   1.4921 
   3  -2260.348   5.5124  -2.2344   1.4921 
   4  -2260.351   5.5124  -2.2366   1.4936 
   5  -2260.355   5.5069  -2.2366   1.4921 
   6  -2260.350   5.5124  -2.2388   1.4921 
   7  -2260.350   5.5124  -2.2366   1.4906 
   8  -2260.357   5.5179  -2.2344   1.4921 
   9  -2260.361   5.5179  -2.2366   1.4936 
  10  -2260.353   5.5124  -2.2344   1.4936 
  11  -2260.348   5.5124  -2.2366   1.4921 
Completed in 3.19 seconds at 18:19:07 04 Feb 2025 </code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit2r</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`session = 6`
       link   estimate SE.estimate        lcl       ucl
D       log 247.736992  13.9705898 221.833584 276.66513
g0    logit   0.096511   0.0083617   0.081319   0.11419
sigma   log   4.446466   0.1603473   4.143136   4.77200

$`session = 7`
       link   estimate SE.estimate        lcl       ucl
D       log 247.736992  13.9705898 221.833584 276.66513
g0    logit   0.096511   0.0083617   0.081319   0.11419
sigma   log   4.446466   0.1603473   4.143136   4.77200</code></pre>
</div>
</div>
<p>The trapping sessions were only 4 weeks apart in spring 1995. We can further investigate session differences by fitting a session-specific model. The fastest way to fit fully session-specific models is to fit each session separately; <code>lapply</code> here applies <code>secr.fit</code> separately to each component of <code>infraCH</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fits3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">infraCH</span>, <span class="va">secr.fit</span>, buffer <span class="op">=</span> <span class="fl">25</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">fits3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"secrlist"</span>  <span class="co"># ensure secr will recognise the fitted models</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fits3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`6`
       link  estimate SE.estimate      lcl       ucl
D       log 255.75743   28.377392 205.9077 317.67570
g0    logit   0.17127    0.029904   0.1203   0.23799
sigma   log   2.51903    0.181296   2.1880   2.90012

$`7`
       link   estimate SE.estimate        lcl       ucl
D       log 278.011710   18.823824 243.497884 317.41759
g0    logit   0.098947    0.011107   0.079208   0.12295
sigma   log   4.951468    0.218378   4.541623   5.39830</code></pre>
</div>
</div>
<p>Notice that there is no issue with starting values when the sessions are treated separately. The skinks appeared to enlarge their home ranges as the weather warmed; they may also have become more active overall<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. It is plausible that density did not change: the estimate increased slightly, but there is substantial overlap of confidence intervals.</p>
</section><section id="log-likelihood-becomes-na-or-improbably-large-after-a-few-evaluations" class="level2" data-number="A.4"><h2 data-number="A.4" class="anchored" data-anchor-id="log-likelihood-becomes-na-or-improbably-large-after-a-few-evaluations">
<span class="header-section-number">A.4</span> Log likelihood becomes NA or improbably large after a few evaluations</h2>
<p>The default maximization method (Newton-Raphson in function <code>nlm</code>) takes a large step away from the initial values at evaluation <code>np + 3</code> where <code>np</code> is the number of estimated coefficients. This often results in a very negative or NA log likelihood, from which the algorithm quickly returns to a reasonable part of the parameter space. However, for some problems it does not return and estimation fails, possibly with a weird message about infinite density. Two solutions are suggested:</p>
<ul>
<li>change to the more robust Nelder-Mead maximization algorithm</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">secr.fit</span><span class="op">(</span><span class="va">CH</span>, method <span class="op">=</span> <span class="st">"Nelder-Mead"</span>, <span class="va">...</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>vary the scaling of each parameter in <code>nlm</code> by passing the <code>typsize</code> (typical size) argument. The default is <code>typsize = rep(1, np)</code>. Suppose your model has four coefficients and it is the second one that appears to be behaving wildly:</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">secr.fit</span><span class="op">(</span><span class="va">CH</span>, typsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In these examples <code>CH</code> is your capthist object and <code>...</code> indicates other arguments of <code>secr.fit</code>.</p>
</section><section id="possible-maximization-error-nlm-code-3" class="level2" data-number="A.5"><h2 data-number="A.5" class="anchored" data-anchor-id="possible-maximization-error-nlm-code-3">
<span class="header-section-number">A.5</span> Possible maximization error: nlm code 3</h2>
<p></p>
<p>The default algorithm for numerical maximization of the likelihood is <code>nlm</code> in the base R <strong>stats</strong> package. That uses a Newton-Raphson algorithm and numerical derivatives. It was chosen because it is significantly faster than the alternatives. However, it sometimes returns estimates with the ambiguous result code 3, which means that the optimization process terminated because “[the] last global step failed to locate a point lower than estimate. Either estimate is an approximate local minimum of the function or steptol is too small.”</p>
<p>Here is an example:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu">secr.fit</span><span class="op">(</span><span class="va">infraCH</span>, buffer <span class="op">=</span> <span class="fl">25</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">g0</span><span class="op">~</span><span class="va">session</span>, </span>
<span>    <span class="va">sigma</span><span class="op">~</span><span class="va">session</span><span class="op">)</span>, details <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>autoini <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p></p>
<p>The results seem usually to be reliable even when this warning is given. If you are nervous, you can try a different algorithm in <code>secr.fit</code> – “Nelder-Mead” is recommended. We can derive starting values from the earlier fit:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit3nm</span> <span class="op">&lt;-</span> <span class="fu">secr.fit</span><span class="op">(</span><span class="va">infraCH</span>, buffer <span class="op">=</span> <span class="fl">25</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">g0</span><span class="op">~</span><span class="va">session</span>, </span>
<span>    <span class="va">sigma</span><span class="op">~</span><span class="va">session</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"Nelder-Mead"</span>, start <span class="op">=</span> <span class="va">fit3</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is no warning. Comparing the density estimates we see a trivial difference in the SE and confidence limits and none at all in the estimates themselves:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">collate</span><span class="op">(</span><span class="va">fit3</span>, <span class="va">fit3nm</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,,,<span class="st">'D'</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       estimate SE.estimate    lcl    ucl
fit3     271.94      15.863 242.58 304.85
fit3nm   271.94      15.809 242.68 304.73</code></pre>
</div>
</div>
<p>This suggests that only the variance-covariance estimates were in doubt, and it would have been much quicker merely to check them with <code>method = "none"</code> as in the previous section.</p>
</section><section id="possible-maximization-error-nlm-code-4" class="level2" data-number="A.6"><h2 data-number="A.6" class="anchored" data-anchor-id="possible-maximization-error-nlm-code-4">
<span class="header-section-number">A.6</span> Possible maximization error: nlm code 4</h2>
<p></p>
<p>The <code>nlm</code> Newton-Raphson algorithm may also finish with the result code 4, which means that the optimization process terminated when the maximum number of iterations was reached (“iteration limit exceeded”). The maximum is set by the argument <code>iterlim</code> which defaults to 100 (each ‘iteration’ uses several likelihood evaluations to numerically determine the gradient for the Newton-Raphson algorithm).</p>
<p>The number of iterations can be checked retrospectively by examining the nlm output saved in the ‘fit’ component of the fitted model. Ordinarily nlm uses less than 50 iterations (for example <code>fit3$fit$iterations =</code> 26).</p>
<p>A ‘brute force’ solution is to increase <code>iterlim</code> (<code>secr.fit()</code> passes <code>iterlim</code> directly to <code><a href="https://rdrr.io/r/stats/nlm.html">nlm()</a></code>) or to re-fit the model starting at the previous solution (<code>start = oldfit</code>). This is not guaranteed to work. Alternative algorithms such as <code>method = 'Nelder-Mead'</code> are worth trying, but they may struggle also.</p>
<p>There does not appear to be a universal solution. Slow or poor fitting seems more common when there are many beta parameters, and when one or more parameters is very imprecise, at a boundary, or simply unidentifiable. It is suggested that you examine the coefficients of the provisional result with <code>coef(fit)</code> and seek to eliminate those that are not identifiable.</p>
<p>Tricks include:</p>
<ul>
<li>combining levels of poorly supported factor covariates</li>
<li>fixing the value of non-identifiable beta parameters with details argument <code>fixedbeta</code>
</li>
<li>ensuring that all levels of a factor x factor interaction are represented in the data (possibly by defining a single factor with valid levels)</li>
<li>changing the coding of factor covariates with details argument <code>contrasts</code>.</li>
</ul>
<p>The following code demonstrates fixing a beta parameter, although it is neither needed nor recommended in this case.</p>
<div class="cell">
<details class="code-fold"><summary>code to fix beta</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># review the fitted values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                   beta  SE.beta      lcl      ucl
D               5.60558 0.058282  5.49135  5.71981
g0             -1.62710 0.197141 -2.01349 -1.24071
g0.session7    -0.57521 0.225301 -1.01679 -0.13363
sigma           0.91986 0.071333  0.78005  1.05967
sigma.session7  0.68197 0.082388  0.52049  0.84345</code></pre>
</div>
<details class="code-fold"><summary>code to fix beta</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># extract the coefficients</span></span>
<span><span class="va">betafix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit3</span><span class="op">)</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="co"># set first 4 values to NA as we want to estimate these</span></span>
<span><span class="va">betafix</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">betafix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1]      NA      NA      NA      NA 0.68197</code></pre>
</div>
<details class="code-fold"><summary>code to fix beta</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># refit, holding last coefficient constant</span></span>
<span><span class="va">fit3a</span> <span class="op">&lt;-</span> <span class="fu">secr.fit</span><span class="op">(</span><span class="va">infraCH</span>, buffer <span class="op">=</span> <span class="fl">25</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">g0</span><span class="op">~</span><span class="va">session</span>, <span class="va">sigma</span><span class="op">~</span><span class="va">session</span><span class="op">)</span>,</span>
<span>         details <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>autoini <span class="op">=</span> <span class="fl">2</span>, fixedbeta <span class="op">=</span> <span class="va">betafix</span><span class="op">)</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit3a</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                beta  SE.beta      lcl     ucl
D            5.60565 0.058123  5.49173  5.7196
g0          -1.62716 0.137059 -1.89579 -1.3585
g0.session7 -0.57523 0.129459 -0.82897 -0.3215
sigma        0.91984 0.034977  0.85129  0.9884</code></pre>
</div>
</div>
<p>Note that the estimated coefficients (‘beta’) have not changed, but the estimated ‘SE.beta’ of each detection parameter has dropped - a result of our spurious claim to know the true value of ‘sigma.session7’.</p>
<p>There is no direct mechanism for holding the beta parameters for different levels of a factor (e.g., <code>session</code>) at a single value. The effect can be achieved by defining a new factor covariate with combined levels.</p>
</section><section id="secr.fit-requests-more-memory-than-is-available" class="level2" data-number="A.7"><h2 data-number="A.7" class="anchored" data-anchor-id="secr.fit-requests-more-memory-than-is-available">
<span class="header-section-number">A.7</span> <code>secr.fit</code> requests more memory than is available</h2>
<p></p>
<p>In <strong>secr</strong> 5.2 the memory required by the external C code is at least <span class="math inline">32 \times C \times M \times K</span> bytes, where <span class="math inline">C</span> is the number of distinct sets of values for the detection parameters (across all individuals, occasions, detectors and finite mixture classes), <span class="math inline">M</span> is the number of points in the habitat mask and <span class="math inline">K</span> is the number of detectors. Each distinct set of values appears as a row in a lookup table<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> whose columns correspond to real parameters; a separate parameter index array (PIA) has entries that point to rows in the lookup table. Four arrays with dimension <span class="math inline">C \times M \times K</span> are pre-filled with, for example, the double-precision (8-byte) probability an animal in mask cell <span class="math inline">m</span> is caught in detector <span class="math inline">k</span> under parameter values <span class="math inline">c</span>.</p>
<p>The number of distinct parameter sets <span class="math inline">C</span> can become large when any real parameter (g0, lambda0, sigma) is modelled as a function of continuous covariates, because each unit (individual, detector, occasion) potentially has a unique level of the parameter. A rough calculation may be made of the maximum size of <span class="math inline">C</span> for a given amount of available RAM. Given say 6GB of available RAM, <span class="math inline">K = 200</span> traps, and <span class="math inline">M = 4000</span> mask cells, <span class="math inline">C</span> should be substantially less than 6e9 / 200 / 4000 / 32 <span class="math inline">\approx</span> 234. Allowance must be made for other memory allocations; this is simply the largest.</p>
<p>There is a different lookup table for each session; the limiting <span class="math inline">C</span> is for the most complex session. The memory constraint concerns detection parameters only.</p>
<p>Most analyses can be configured to bring the memory request down to a reasonable number.</p>
<ol type="1">
<li>
<span class="math inline">C</span> may be reduced by replacing each continuous covariate with one using a small number of discrete levels (e.g.&nbsp;the mid-points of weight classes). For example, <code>weightclass &lt;- 10 * trunc(weight/10) + 5</code> for midpoints of 10-g classes.</li>
<li>
<span class="math inline">M</span> can be reduced by building a habitat mask with an appropriate spacing (see [secr-habitatmasks.pdf]).</li>
<li>
<span class="math inline">K</span> might seem to be fixed by the design, but in extreme cases it may be appropriate to combine data from adjacent detectors (see <a href="A02-speed.html#collapsedetectors">Collapsing detectors</a>).</li>
</ol>
<p>The <code>mash</code> function (see <a href="A02-speed.html#mash">Mashing</a>) may be used to reduce the number of detectors when the design uses many identical and independent clusters. Otherwise, apply your ingenuity to simplify your model, e.g., by casting ‘groups’ as ‘sessions’. Memory is less often an issue on 64-bit systems (see also <code><a href="https://rdrr.io/r/base/Memory-limits.html">?"Memory-limits"</a></code>).</p>
</section><section id="covariate-factor-levels-differ-between-sessions" class="level2" data-number="A.8"><h2 data-number="A.8" class="anchored" data-anchor-id="covariate-factor-levels-differ-between-sessions">
<span class="header-section-number">A.8</span> Covariate factor levels differ between sessions</h2>
<p></p>
<p>This is fairly explicit; <code>secr.fit</code> will stop if you include in a model any covariate whose factor levels vary among sessions, and <code>verify</code> will warn if it finds any covariate like this. This commonly occurs in multi-session datasets with ‘sex’ as an individual covariate when only males or only females are detected in one session. Use the function <a href="./14-multisession.html#sharefactorlevels"><code>shareFactorLevels</code></a> to force covariates to use the same superset of levels in all sessions.</p>
</section><section id="estimates-depend-on-starting-values" class="level2" data-number="A.9"><h2 data-number="A.9" class="anchored" data-anchor-id="estimates-depend-on-starting-values">
<span class="header-section-number">A.9</span> Estimates depend on starting values</h2>
<p>Instability of the estimates can result when the likelihood surface has a local maximum and is said to be ‘multimodal’. Numerical maximisation may then fail to find the true maximum from a given starting point. Nelder-Mead is more robust than other methods.</p>
<p>Finite mixture models have known problems due to multimodality of the likelihood, as discussed separately (<a href="15-finite-mixtures.html" class="quarto-xref"><span>Chapter 15</span></a>). See <span class="citation" data-cites="de09">Dawson &amp; Efford (<a href="A99-references.html#ref-de09" role="doc-biblioref">2009</a>)</span> and the vignette <a href="https://www.otago.ac.nz/density/pdfs/secr-sound.pdf">secr-sound.pdf</a> for another example of a multimodal likelihood in SECR.</p>
<p>It is suspected that extreme (over-coarse) discretisation of the habitat mask sometimes results in instability due to local maxima, but this has not been proven.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-de09" class="csl-entry" role="listitem">
Dawson, D. K., &amp; Efford, M. G. (2009). Bird population density estimated from acoustic signals. <em>Journal of Applied Ecology</em>, <em>46</em>, 1201–1209.
</div>
<div id="ref-gvccm04" class="csl-entry" role="listitem">
Gimenez, O., Viallefont, A., Catchpole, E. A., Choquet, R., &amp; Morgan, B. J. T. (2004). Methods for investigating parameter redundancy. <em>Animal Biodiversity and Conservation</em>, <em>27</em>, 561–572.
</div>
<div id="ref-Kendeigh1944" class="csl-entry" role="listitem">
Kendeigh, S. C. (1944). Measurement of bird populations. <em>Ecological Monographs</em>, <em>14</em>, 67–106. <a href="https://doi.org/10.2307/1961632">https://doi.org/10.2307/1961632</a>
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Home-range area increased about 4-fold; g0 showed some compensatory decrease, but compensation was incomplete, implying increased total activity (treating <span class="math inline">g_0</span> as an approximation to <span class="math inline">\lambda_0</span>; see Efford and Mowat 2014).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>You can see this table by running <code>secr.fit</code> with <code>details = list(debug = 3)</code> and typing <code>Xrealparval</code> at the browser prompt (type Q to exit).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="./17-simulation.html" class="pagination-link" aria-label="Simulation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Simulation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./A02-speed.html" class="pagination-link" aria-label="Faster is better">
        <span class="nav-page-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Faster is better</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>