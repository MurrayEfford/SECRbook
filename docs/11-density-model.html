<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Spatially Explicit Capture–Recapture - 11&nbsp; Density model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./12-habitat.html" rel="next">
<link href="./10-detection-model.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script><script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-secr-package.html">Practice</a></li><li class="breadcrumb-item"><a href="./11-density-model.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Density model</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatially Explicit Capture–Recapture</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/MurrayEfford/SECRbook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foreword</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Concepts and terminology</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Simple example</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Likelihood-based SECR</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-theory-area-search.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Area search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-theory-special-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Special topics</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Performance</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Assumptions and robustness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Empirical validation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-studydesign.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Study design</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Practice</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-secr-package.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">R package secr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-detection-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Detection model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-density-model.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Density model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-habitat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Habitat mask</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-fittedmodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Working with fitted models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-multisession.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Multiple sessions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-finite-mixtures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Individual heterogeneity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-sex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Sex differences</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Simulation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A01-troubleshooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Troubleshooting <strong>secr</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A02-speed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Faster is better</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A03-spatial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A04-polygondetectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Area and transect search</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A05-mark-resight.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Mark-resight models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A06-noneuclidean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Non-Euclidean distances</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A07-telemetry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Telemetry</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A08-parameterizations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Parameterizations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A09-densityappendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Density revisited</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A10-trend.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Trend revisited</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A11-expected-counts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Expected counts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A12-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A99-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
<li><a href="#absolute-vs-relative-density" id="toc-absolute-vs-relative-density" class="nav-link active" data-scroll-target="#absolute-vs-relative-density"><span class="header-section-number">11.1</span> Absolute vs relative density</a></li>
  <li><a href="#brushtail-possum-example" id="toc-brushtail-possum-example" class="nav-link" data-scroll-target="#brushtail-possum-example"><span class="header-section-number">11.2</span> Brushtail possum example</a></li>
  <li><a href="#using-the-model-argument" id="toc-using-the-model-argument" class="nav-link" data-scroll-target="#using-the-model-argument"><span class="header-section-number">11.3</span> Using the ‘model’ argument</a></li>
  <li><a href="#prediction-and-plotting" id="toc-prediction-and-plotting" class="nav-link" data-scroll-target="#prediction-and-plotting"><span class="header-section-number">11.4</span> Prediction and plotting</a></li>
  <li><a href="#sec-scaling" id="toc-sec-scaling" class="nav-link" data-scroll-target="#sec-scaling"><span class="header-section-number">11.5</span> Scaling</a></li>
  <li><a href="#not-a-density-surface" id="toc-not-a-density-surface" class="nav-link" data-scroll-target="#not-a-density-surface"><span class="header-section-number">11.6</span> This is not a density surface</a></li>
  <li><a href="#relativedensity2" id="toc-relativedensity2" class="nav-link" data-scroll-target="#relativedensity2"><span class="header-section-number">11.7</span> Relative density</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-secr-package.html">Practice</a></li><li class="breadcrumb-item"><a href="./11-density-model.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Density model</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-density" class="quarto-section-identifier"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Density model</span></span></h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header><p></p>
<p>Spatially explicit capture–recapture models allow for population density to vary over space <span class="citation" data-cites="be08">(<a href="A99-references.html#ref-be08" role="doc-biblioref">Borchers &amp; Efford, 2008</a>)</span>. Density is the intensity of a spatial Poisson process for activity centres. Models for density may include spatial covariates (e.g., vegetation type, elevation) and spatial trend.</p>
<p>In <a href="10-detection-model.html" class="quarto-xref"><span>Chapter 10</span></a> we introduced <a href="./10-detection-model.html#linear-submodels">linear sub-models</a> for detection parameters. Here we consider SECR models in which the population density at any point, considered on the link scale, is also a linear function of <span class="math inline">V</span> covariates<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. For density this means</p>
<p><span class="math display">\begin{equation}
D(\mathbf x; \phi) = f^{-1}[\phi_0 + \sum_{v=1}^V c_v(\mathbf x) \, \phi_v],
\end{equation}</span> where <span class="math inline">c_v(\mathbf x)</span> is the value of the <span class="math inline">v</span>-th covariate at point <span class="math inline">\mathbf x</span>, <span class="math inline">\phi_0</span> is the intercept, <span class="math inline">\phi_v</span> is the coefficient for the <span class="math inline">v</span>-th covariate, and <span class="math inline">f^{-1}</span> is the inverse of the link function. Commonly we model the logarithm of density and <span class="math inline">f^{-1}</span> is the exponential function.</p>
<p>Although <span class="math inline">D(\mathbf x;\phi)</span> is often a smooth function, in <strong>secr</strong> we evaluate it only at the fixed points of the habitat mask (<a href="12-habitat.html" class="quarto-xref"><span>Chapter 12</span></a>). A mask defines the region of habitat relevant to a particular study: in the simplest case it is a buffered zone inclusive of the detector locations. More complex masks may exclude interior areas of non-habitat or have an irregular outline.</p>
<p>A density model <span class="math inline">D(\mathbf x;\phi)</span> is specified in the ‘model’ argument of <code>secr.fit</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Spatial covariates, if any, are needed for each mask point; they are stored in the ‘covariates’ attribute of the mask. Results from fitting the model (including the estimated coefficients <span class="math inline">\phi</span>) are saved in an object of class ‘secr’. To visualise a fitted density model we first evaluate it at each point on a mask with the function <code>predictDsurface</code>. This creates an object of class ‘Dsurface’. A Dsurface is a mask with added density data, and plotting a Dsurface is like plotting a mask covariate.</p>
<p><br></p>
<div id="tbl-Dexamples" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-Dexamples-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;11.1: Some examples of models for density in <code>secr.fit</code>.
</figcaption><div aria-describedby="tbl-Dexamples-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<colgroup>
<col style="width: 28%">
<col style="width: 71%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Formula</th>
<th style="text-align: left;">Effect</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">D <span class="math inline">\sim</span> cover</td>
<td style="text-align: left;">density varies with ‘cover’, a variable in covariates(mask)</td>
</tr>
<tr class="even">
<td style="text-align: left;">list(D <span class="math inline">\sim</span> g, g0 <span class="math inline">\sim</span> g)</td>
<td style="text-align: left;">both density and g0 differ between groups</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D <span class="math inline">\sim</span> session</td>
<td style="text-align: left;">session-specific density</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<section id="absolute-vs-relative-density" class="level2" data-number="11.1"><h2 data-number="11.1" class="anchored" data-anchor-id="absolute-vs-relative-density">
<span class="header-section-number">11.1</span> Absolute vs relative density</h2>
<p>The conventional approach to density surfaces is to fit a model of absolute density by maximizing the ‘full’ likelihood. Until recently, maximizing the likelihood <a href="./05-theory-special-topics.html#conditional">conditional on <span class="math inline">n</span></a>, the number detected, was thought to work only when density was assumed to be uniform (homogeneous), placing it outside the scope of this chapter. However, recent extensions to <strong>secr</strong> allow models of <em>relative</em> density to be fitted by maximizing the conditional likelihood (<code>CL = TRUE</code> in <code>secr.fit</code>), and this has some advantages <span class="citation" data-cites="Efford2025">(<a href="A99-references.html#ref-Efford2025" role="doc-biblioref">Efford, 2025</a>)</span>. Relative density differs from absolute density by a constant factor. This chapter stresses modelling absolute density and keeps <a href="#relativedensity2">relative density</a> for a section at the end.</p>
</section><section id="brushtail-possum-example" class="level2" data-number="11.2"><h2 data-number="11.2" class="anchored" data-anchor-id="brushtail-possum-example">
<span class="header-section-number">11.2</span> Brushtail possum example</h2>
<p></p>
<p>For illustration we use a brushtail possum (<em>Trichosurus vulpecula</em>) dataset from the Orongorongo Valley, New Zealand. Possums were live-trapped in mixed evergreen forest near Wellington for nearly 40 years <span class="citation" data-cites="ec04">(<a href="A99-references.html#ref-ec04" role="doc-biblioref">Efford &amp; Cowan, 2004</a>)</span>. Single-catch traps were set for 5 consecutive nights, three times a year. The dataset ‘OVpossumCH’ has data from the years 1996 and 1997. The study grid was bounded by a shingle riverbed to the north and west. See ?OVpossum in <strong>secr</strong> for more details.</p>
<p>First we import data for the habitat mask from a polygon shapefile included with the package:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">datadir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"secr"</span><span class="op">)</span></span>
<span><span class="va">OVforest</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">datadir</span>, <span class="st">"/OVforest.shp"</span><span class="op">)</span>, </span>
<span>    quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># drop points we don't need</span></span>
<span><span class="va">leftbank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">datadir</span>,<span class="st">"/leftbank.txt"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">21</span><span class="op">:</span><span class="fl">195</span>,<span class="op">]</span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">6</span>, width <span class="op">=</span> <span class="fl">95</span><span class="op">)</span>       </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>OVforest is now a simple features (sf) object defined in package <strong>sf</strong>. We build a habitat mask object, selecting the first two polygons in OVforest and discarding the third that lies across the river. The attribute table of the shapefile (and hence OVforest) includes a categorical variable ‘forest’ that is either ‘beech’ (<em>Nothofagus</em> spp.) or ‘nonbeech’ (mixed podocarp-hardwood); <code>addCovariates</code> attaches these data to each cell in the mask.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ovtrap</span> <span class="op">&lt;-</span> <span class="fu">traps</span><span class="op">(</span><span class="va">OVpossumCH</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">ovmask</span> <span class="op">&lt;-</span> <span class="fu">make.mask</span><span class="op">(</span><span class="va">ovtrap</span>, buffer <span class="op">=</span> <span class="fl">120</span>, type <span class="op">=</span> <span class="st">"trapbuffer"</span>,</span>
<span>    poly <span class="op">=</span> <span class="va">OVforest</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="op">]</span>, spacing <span class="op">=</span> <span class="fl">7.5</span>, keep.poly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">ovmask</span> <span class="op">&lt;-</span> <span class="fu">addCovariates</span><span class="op">(</span><span class="va">ovmask</span>, <span class="va">OVforest</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting is easy:</p>
<div class="cell">
<details class="code-fold"><summary>code to plot possum mask</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">6</span>,<span class="fl">2</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">forestcol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ovmask</span>, cov<span class="op">=</span><span class="st">"forest"</span>, dots <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="va">forestcol</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ovtrap</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/sbar.html">sbar</a></span><span class="op">(</span>d <span class="op">=</span> <span class="fl">200</span>, xy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2674670</span>, <span class="fl">5982930</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'line'</span>, </span>
<span>    divs <span class="op">=</span> <span class="fl">2</span>, below <span class="op">=</span> <span class="st">"metres"</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>,<span class="st">"100"</span>,<span class="st">"200"</span><span class="op">)</span>, </span>
<span>    ticks <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/north.html">north</a></span><span class="op">(</span>xy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2674670</span>, <span class="fl">5982830</span><span class="op">)</span>, d <span class="op">=</span> <span class="fl">40</span>, label <span class="op">=</span> <span class="st">"N"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-ovmaskplot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ovmaskplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="11-density-model_files/figure-html/fig-ovmaskplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" data-glightbox="description: .lightbox-desc-1"><img src="11-density-model_files/figure-html/fig-ovmaskplot-1.png" class="img-fluid figure-img" style="width:90.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ovmaskplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.1: Orongorongo Valley possum study area
</figcaption></figure>
</div>
</div>
</div>
<p>We next fit some simple models to data from February 1996 (session 49). Some warnings are suppressed for clarity.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>capthist <span class="op">=</span> <span class="va">OVpossumCH</span><span class="op">[[</span><span class="st">'49'</span><span class="op">]</span><span class="op">]</span>, mask <span class="op">=</span> <span class="va">ovmask</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">D</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">D</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span>, <span class="va">D</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">y2</span> <span class="op">+</span> <span class="va">xy</span>, <span class="va">D</span> <span class="op">~</span> <span class="va">forest</span><span class="op">)</span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'null'</span>,<span class="st">'Dxy'</span>,<span class="st">'Dxy2'</span>, <span class="st">'Dforest'</span><span class="op">)</span></span>
<span><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu">list.secr.fit</span><span class="op">(</span>model <span class="op">=</span> <span class="va">models</span>, constant <span class="op">=</span> <span class="va">args</span>, names <span class="op">=</span> <span class="va">names</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        npar   logLik  dAIC  AICwt
Dxy2       8 -1549.32 0.000 0.4429
Dxy        5 -1552.86 1.086 0.2573
Dforest    4 -1554.15 1.653 0.1938
null       3 -1555.75 2.860 0.1060</code></pre>
</div>
</div>
<p>Each of the inhomogeneous models seems marginally better than the null model, but there is little to choose among them.</p>
<p>To visualise the entire surface we compute predicted density at each mask point. For example, we can plot the quadratic surface like this:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">6</span>,<span class="fl">2</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">surfaceDxy2</span> <span class="op">&lt;-</span> <span class="fu">predictDsurface</span><span class="op">(</span><span class="va">fits</span><span class="op">$</span><span class="va">Dxy2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">surfaceDxy2</span>, plottype <span class="op">=</span> <span class="st">"shaded"</span>, poly <span class="op">=</span> <span class="cn">FALSE</span>, breaks <span class="op">=</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">22</span>,<span class="fl">2</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"Density / ha"</span>, text.cex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># graphical elements to be added, including contours of Dsurface</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ovtrap</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">surfaceDxy2</span>, plottype <span class="op">=</span> <span class="st">"contour"</span>, poly <span class="op">=</span> <span class="cn">FALSE</span>, breaks <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">22</span>,<span class="fl">2</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">leftbank</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-OVsurface" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-OVsurface-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="11-density-model_files/figure-html/fig-OVsurface-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" data-glightbox="description: .lightbox-desc-2"><img src="11-density-model_files/figure-html/fig-OVsurface-1.png" class="img-fluid figure-img" style="width:90.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-OVsurface-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.2: Quadratic possum density surface
</figcaption></figure>
</div>
</div>
</div>
<p>Following sections expand on the options for specifying and displaying density models.</p>
</section><section id="using-the-model-argument" class="level2" data-number="11.3"><h2 data-number="11.3" class="anchored" data-anchor-id="using-the-model-argument">
<span class="header-section-number">11.3</span> Using the ‘model’ argument</h2>
<p>A model formula defines variation in each parameter as a function of covariates (including geographic coordinates and their polynomial terms) that is linear on the ‘link’ scale, as in a generalized linear model.</p>
<p>The options differ between the state and observation models. D may vary with respect to group, session or point in space</p>
<p>The predictors ‘group’ and ‘session’ behave for D as they do for other real parameters. They determine variation in the expected density for each group or session that is (by default) uniform across space, leading to a homogeneous Poisson model and a flat surface. No further explanation is therefore needed.</p>
<section id="link-function" class="level3" data-number="11.3.1"><h3 data-number="11.3.1" class="anchored" data-anchor-id="link-function">
<span class="header-section-number">11.3.1</span> Link function</h3>
<p></p>
<p>The default link for D is ‘log’. It is equally feasible in most cases to choose ‘identity’ as the link (see the <code>secr.fit</code> argument ‘link’), and for the null model D <span class="math inline">\sim</span> 1 the estimate will be the same to numerical accuracy, as will estimates involving only categorical variables (e.g., session). However, with an ‘identity’ link the usual (asymptotic) confidence limits will be symmetrical (unless truncated at zero) rather than asymmetrical. In models with continuous predictors, including spatial trend surfaces, the link function will affect the result, although the difference may be small when the amplitude of variation on the surface is small. Otherwise, serious thought is needed regarding which model is biologically more appropriate: logarithmic or linear.</p>
<p>The ‘identity’ link may cause problems when density is very small or very large because, by default, the maximization method assumes all parameters have similar scale (e.g., <code>typsize = c(1,1,1)</code> for default constant models). Setting <code>typsize</code> manually in a call to <code>secr.fit</code> can fix the problem and speed up fitting. For example, if density is around 0.001/ha (10 per 100 km<span class="math inline">^2</span>) then call <code>secr.fit(..., typsize = c(0.001,1,1))</code> (<code>typsize</code> has one element for each beta parameter). Problems with the identity link mostly disappear when modelling relative density (<code>CL = TRUE</code>) because coefficients are automatically scaled by the intercept. See <a href="A09-densityappendix.html" class="quarto-xref"><span>Appendix I</span></a> for more on link functions.</p>
<p>You may wonder why <code>secr.fit</code> is ambivalent regarding the link function: link functions have seemed a necessary part of the machinery for capture–recapture modelling since Lebreton et al.&nbsp;(1992). Their key role is to keep the ‘real’ parameter within feasible bounds (e.g., 0-1 for probabilities). In <code>secr.fit</code> any modelled value of D that falls below zero is truncated at zero (of course this condition will not arise with a log link).</p>
</section><section id="built-in-variables" class="level3" data-number="11.3.2"><h3 data-number="11.3.2" class="anchored" data-anchor-id="built-in-variables">
<span class="header-section-number">11.3.2</span> Built-in variables</h3>
<p></p>
<p><code>secr.fit</code> automatically recognises the spatial variables x, y, x2, y2 and xy if they appear in the formula for D. These refer to the x-coordinate, y-coordinate, x-coordinate<sup>2</sup> etc. for each mask point, and will be constructed automatically as needed. The built-in spatial variables offer limited model possibilities (<a href="#tbl-builtin" class="quarto-xref">Table&nbsp;<span>11.2</span></a>).</p>
<p>The formula for D may also include the non-spatial variables g (group), session (categorical), and Session (continuous), defined as for modelling g0 and sigma in <a href="10-detection-model.html" class="quarto-xref"><span>Chapter 10</span></a>.</p>
<div id="tbl-builtin" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-builtin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;11.2: Examples of density models using built-in variables.
</figcaption><div aria-describedby="tbl-builtin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<thead><tr class="header">
<th>Formula</th>
<th>Interpretation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>D ~ 1</td>
<td>flat surface (default)</td>
</tr>
<tr class="even">
<td>D ~ x + y</td>
<td>linear trend surface (planar)</td>
</tr>
<tr class="odd">
<td>D ~ x + x2</td>
<td>quadratic trend in east-west direction only</td>
</tr>
<tr class="even">
<td>D ~ x + y + x2 + y2 + xy</td>
<td>quadratic trend surface</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<!---
% \subsection*{Orthogonal polynomials}
%
% Specifying a quadratic trend surface as in the previous section is
% both ugly and undesirable because the terms (x, x2 etc.) tend to be
% highly correlated. The easy alternative is to specify an orthogonal
% polynomial (OP) with the R function `poly`. Orthogonal polynomials
% are transformations of the original polynomial variables that have the
% property of 'orthogonality'. You don't need to know how to compute
% them - it's automatic. The last three models could better be expressed:
%
% \begin{tabular} { l l}
% D $\sim$ poly(x,y) & OP linear trend surface (planar) \\
% D $\sim$ poly(x,2) & OP quadratic trend in east-west direction only \\
% D $\sim$ poly(x,y, degree = 2) & OP quadratic trend surface \\
% etc. & \\
% \end{tabular}
% (The argument name 'degree' must be spelled out if there is more than
% one predictor).
% Orthogonal polynomials are new in **secr} 2.9.0. Prediction from
% OP models is tricky -- it requires the 'secr' model object to retain
% the details of how the OP were constructed -- but transparent to the
% user.
%
% Polynomial surfaces (OP and otherwise) take a very limited range of
% shapes. They are also prone to extrapolation errors: the predicted
% surface outside the detector array is often unrealistically high or
% low because it is unconstrained by the data.
--->
</section><section id="user-provided-variables" class="level3" data-number="11.3.3"><h3 data-number="11.3.3" class="anchored" data-anchor-id="user-provided-variables">
<span class="header-section-number">11.3.3</span> User-provided variables</h3>
<p></p>
<p>More interesting models can be made with variables provided by the user. These are stored in a data frame as the ‘covariates’ attribute of a mask object. Covariates must be defined for every point on a mask.</p>
<p>Variables may be categorical (a factor or character value that can be coerced to a factor) or continuous (a numeric vector). The habitat variable ‘habclass’ constructed in the Examples section of the <code>skink</code> help is an example of a two-class categorical covariate. Remember that categorical variables entail one additional parameter for each extra level.</p>
<p>There are several ways to create or input mask covariates.</p>
<ol type="1">
<li><p>Read columns of covariates along with the x- and y-coordinates when creating a mask from a dataframe or external file (<code>read.mask</code>)</p></li>
<li><p>Read the covariates dataframe separately from an external file (<code>read.table</code>)</p></li>
<li><p>Infer covariate values by computation on in existing mask (see below).</p></li>
<li><p>Infer values for points on an existing mask from a GIS data source, such as a polygon shapefile or other spatial data source (see <a href="A03-spatial-data.html" class="quarto-xref"><span>Appendix C</span></a>).</p></li>
</ol>
<p>Use the function <code>addCovariates</code> for the third and fourth options.</p>
</section><section id="covariates-computed-from-coordinates" class="level3" data-number="11.3.4"><h3 data-number="11.3.4" class="anchored" data-anchor-id="covariates-computed-from-coordinates">
<span class="header-section-number">11.3.4</span> Covariates computed from coordinates</h3>
<p>Higher-order polynomial terms may be added as covariates if required. For example,</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">covariates</span><span class="op">(</span><span class="va">ovmask</span><span class="op">)</span><span class="op">[</span>,<span class="st">"x3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">covariates</span><span class="op">(</span><span class="va">ovmask</span><span class="op">)</span><span class="op">$</span><span class="va">x</span><span class="op">^</span><span class="fl">3</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>allows a model like D ~ x + x2 + x3.</p>
<p>If you have a strong prior reason to suspect a particular ‘grain’ to the landscape then this may be also be computed as a new, artificial covariate. This code gives a covariate representing a northwest – southeast trend:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">covariates</span><span class="op">(</span><span class="va">ovmask</span><span class="op">)</span><span class="op">[</span>,<span class="st">"NWSE"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ovmask</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">ovmask</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ovmask</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">ovmask</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another trick is to compute distances to a mapped landscape feature. For example, possum density in our Orongorongo example may relate to distance from the river; this corresponds roughly to elevation, which we do not have to hand. The <code>distancetotrap</code> function of <strong>secr</strong> computes distances from mask cells to the nearest vertex on the riverbank, which are precise enough for our purpose.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">covariates</span><span class="op">(</span><span class="va">ovmask</span><span class="op">)</span><span class="op">[</span>,<span class="st">"DTR"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">distancetotrap</span><span class="op">(</span><span class="va">ovmask</span>, <span class="va">leftbank</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">6</span>,<span class="fl">2</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ovmask</span>, covariate <span class="op">=</span> <span class="st">"DTR"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">500</span>,<span class="fl">50</span><span class="op">)</span>, </span>
<span>     title <span class="op">=</span> <span class="st">"Distance to river m"</span>, dots <span class="op">=</span> <span class="cn">FALSE</span>, inset<span class="op">=</span> <span class="fl">0.07</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-dtrplot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-dtrplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="11-density-model_files/figure-html/fig-dtrplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" data-glightbox="description: .lightbox-desc-3"><img src="11-density-model_files/figure-html/fig-dtrplot-1.png" class="img-fluid figure-img" style="width:90.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dtrplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.3: Orongorongo Valley possum study: distance to river
</figcaption></figure>
</div>
</div>
</div>
</section><section id="pre-computed-resource-selection-functions" class="level3" data-number="11.3.5"><h3 data-number="11.3.5" class="anchored" data-anchor-id="pre-computed-resource-selection-functions">
<span class="header-section-number">11.3.5</span> Pre-computed resource selection functions</h3>
<p></p>
<p>A resource selection function (RSF) was defined by <span class="citation" data-cites="bvns02">Boyce et al. (<a href="A99-references.html#ref-bvns02" role="doc-biblioref">2002</a>)</span> as “any model that yields values proportional to the probability of use of a resource unit”. An RSF combines habitat information from multiple sources in a single variable. Typically the function is estimated from telemetry data on marked individuals, and primarily describes individual-level behaviour <span class="citation" data-cites="j80">(3rd-order habitat selection of <a href="A99-references.html#ref-j80" role="doc-biblioref">Johnson, 1980</a>)</span>.</p>
<p>However, the individual-level RSF is also a plausible hypothesis for 2nd-order habitat selection i.e.&nbsp;for modelling the relationship between habitat and population density. Then we interpret the RSF as a single variable that is believed to be proportional to the expected population density in each cell of a habitat mask.</p>
<p>Suppose, for example, in folder datadir we have a polygon shapefile (RSF.shp, RSF.dbf etc.) with the attribute “rsf” defined for each polygon. Given mask and capthist objects “habmask” and “myCH”, this code fits a SECR model that calibrates the RSF in terms of population density:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rsfshape</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">datadir</span>, <span class="st">"/RSF.shp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">habmask</span> <span class="op">&lt;-</span> <span class="fu">addCovariates</span><span class="op">(</span><span class="va">habmask</span>, <span class="va">rsfshape</span>, columns <span class="op">=</span> <span class="st">"rsf"</span><span class="op">)</span></span>
<span><span class="fu">secr.fit</span> <span class="op">(</span><span class="va">myCH</span>, mask <span class="op">=</span> <span class="va">habmask</span>, model <span class="op">=</span> <span class="va">D</span> <span class="op">~</span> <span class="va">rsf</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>“rsf” must be known for every pixel in the habitat mask</li>
<li>Usually it make sense to fit the density model through the origin (rsf = 0 implies D = 0). This is not true of habitat suitability indices in general.</li>
</ul>
<p>This is a quite different approach to fitting multiple habitat covariates within <strong>secr</strong>, and one that should be considered. There are usually too few individuals in a SECR study to usefully fit models with multiple covariates of density, even given a large dataset such as our possum example. However, 3rd-order and 2nd-order habitat selection are conceptually distinct, and their relationship is an interesting research topic.</p>
</section><section id="regression-splines" class="level3" data-number="11.3.6"><h3 data-number="11.3.6" class="anchored" data-anchor-id="regression-splines">
<span class="header-section-number">11.3.6</span> Regression splines</h3>
<p></p>
<p>Regression splines are a flexible alternative to polynomials for spatial trend analysis. Regression splines are familiar as the smooth terms in ‘generalized additive models’ (gams) implemented (differently) in the base R package <strong>gam</strong> and in R package <strong>mgcv</strong> <span class="citation" data-cites="w06">(<a href="A99-references.html#ref-w06" role="doc-biblioref">Wood, 2006</a>)</span>.</p>
<p>Some of the possible smooth terms from <strong>mgcv</strong> can be used in model formulae for <code>secr.fit</code> – see the help page for ‘smooths’ in <strong>secr</strong>. Smooths are specified with terms that look like calls to the functions <code>s</code> and <code>te</code>. Smoothness is determined by the number of knots which is set by the user via the argument ‘k’. The number of knots cannot be determined automatically by the penalty algorithms of <strong>mgcv</strong>.</p>
<p>Here we fit a regression spline with the same number of parameters as a quadratic polynomial, a linear effect of the ‘distance to river’ covariate on log(D), and a nonlinear smooth.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>capthist <span class="op">=</span> <span class="va">OVpossumCH</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, mask <span class="op">=</span> <span class="va">ovmask</span>, trace <span class="op">=</span> </span>
<span>    <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">D</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>, k <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>, <span class="va">D</span> <span class="op">~</span> <span class="va">DTR</span>, <span class="va">D</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">DTR</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">RSfits</span> <span class="op">&lt;-</span> <span class="fu">list.secr.fit</span><span class="op">(</span>model <span class="op">=</span> <span class="va">models</span>, constant <span class="op">=</span> <span class="va">args</span>, </span>
<span>    prefix <span class="op">=</span> <span class="st">"RS"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now add these to the AIC table and plot the ‘AIC-best’ model:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">fits</span>, <span class="va">RSfits</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        npar   logLik  dAIC  AICwt
RS3        5 -1552.00 0.000 0.2667
Dxy2       8 -1549.32 0.628 0.1948
RS2        4 -1553.36 0.705 0.1875
Dxy        5 -1552.86 1.714 0.1132
RS1        8 -1549.93 1.847 0.1059
Dforest    4 -1554.15 2.281 0.0853
null       3 -1555.75 3.488 0.0466</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">newdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>DTR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">400</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">RSfits</span><span class="op">$</span><span class="va">RS3</span>, newdata <span class="op">=</span> <span class="va">newdat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">8</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, pty <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">400</span>,<span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">"["</span>, <span class="st">"D"</span>,<span class="st">"estimate"</span><span class="op">)</span>, </span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"Distance from river (m)"</span>, </span>
<span>    ylab <span class="op">=</span> <span class="st">"Density / ha"</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-OVdtr" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-OVdtr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="11-density-model_files/figure-html/fig-OVdtr-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" data-glightbox="description: .lightbox-desc-4"><img src="11-density-model_files/figure-html/fig-OVdtr-1.png" class="img-fluid figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-OVdtr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.4: Possum density vs distance to river: regression spline <em>k</em> = 3
</figcaption></figure>
</div>
</div>
</div>
<p>Confidence intervals are computed in <code>predictDsurface</code> by back-transforming <span class="math inline">\pm</span> 2SE from the link (log) scale:</p>
<div class="cell">
<details class="code-fold"><summary>code for lower and upper confidence surfaces</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, xpd <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">surfaceDDTR3</span> <span class="op">&lt;-</span> <span class="fu">predictDsurface</span><span class="op">(</span><span class="va">RSfits</span><span class="op">$</span><span class="va">RS3</span>, cl.D <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">surfaceDDTR3</span>, covariate<span class="op">=</span> <span class="st">"lcl"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">22</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>    legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">3</span>,line <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, cex <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>      <span class="st">"Lower 95% confidence limit of D (possums / ha)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">surfaceDDTR3</span>, plottype <span class="op">=</span> <span class="st">"contour"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">22</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">leftbank</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">surfaceDDTR3</span>, covariate<span class="op">=</span> <span class="st">"ucl"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">22</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>    legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">3</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, cex <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    <span class="st">"Upper 95% confidence limit of D (possums / ha)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">surfaceDDTR3</span>, covariate <span class="op">=</span> <span class="st">"ucl"</span>, plottype <span class="op">=</span> <span class="st">"contour"</span>, </span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">22</span>,<span class="fl">2</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">leftbank</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">3</span>, line<span class="op">=</span><span class="op">-</span><span class="fl">1</span>, outer<span class="op">=</span><span class="cn">TRUE</span>, <span class="st">"s(DTR, k = 3) model"</span>, cex <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-CIplot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-CIplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="11-density-model_files/figure-html/fig-CIplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" data-glightbox="description: .lightbox-desc-5"><img src="11-density-model_files/figure-html/fig-CIplot-1.png" class="img-fluid figure-img" style="width:95.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-CIplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.5: Confidence surfaces
</figcaption></figure>
</div>
</div>
</div>
<!---
strip.legend(c(2674460, 5982886), legend = seq(0,22,2), col = terrain.colors(11), title="Density / ha" , text.cex = 1)
--->
<p>Multiple predictors may be included in one ‘s’ smooth term, implying interaction. This assumes isotropy – equality of scales on the different predictors – which is appropriate for geographic coordinates such as x and y in this example. In other cases, predictors may be measured on different scales (e.g., structural complexity of vegetation and elevation) and isotropy cannot be assumed. In these cases a tensor-product smooth (<code>te</code>) is appropriate because it is scale-invariant. For <code>te</code>, ‘k’ represents the order of the smooth on each axis, and we must fix the number of knots with ‘fx = TRUE’ to override automatic selection.</p>
<p>For more on the use of regression splines see the documentation for <strong>mgcv</strong>, the <strong>secr</strong> help page `?smooths’, <span class="citation" data-cites="w06">Wood (<a href="A99-references.html#ref-w06" role="doc-biblioref">2006</a>)</span>, and <span class="citation" data-cites="bk14">Borchers &amp; Kidney (<a href="A99-references.html#ref-bk14" role="doc-biblioref">2014</a>)</span>.</p>
</section><section id="scaleofeffect" class="level3" data-number="11.3.7"><h3 data-number="11.3.7" class="anchored" data-anchor-id="scaleofeffect">
<span class="header-section-number">11.3.7</span> Scale of effect</h3>
<p></p>
<p>Modelling density as a function of covariate(s) at a point (the centroid of a mask cell) lacks biological realism. Individuals exploit resources across their home range, and density may be affected by regional dynamics over a much wider area <span class="citation" data-cites="Jackson2014">(e.g., <a href="A99-references.html#ref-Jackson2014" role="doc-biblioref">Jackson &amp; Fahrig, 2014</a>)</span>.</p>
<p>The scale at which environmental predictors influence density is usually unknown, and almost certainly does not correspond to either a point or the arbitrary size of a mask cell. Some progress has been made in estimating the scale from data <span class="citation" data-cites="Chandler2016">(e.g. <a href="A99-references.html#ref-Chandler2016" role="doc-biblioref">Chandler &amp; Hepinstall-Cymerman, 2016</a>)</span>, but methods have not yet been integrated into SECR.</p>
<p>The best we can do at present is to construct spatial layers in GIS software that represent various levels of smoothing or spatial aggregation, corresponding to different scales of effect. Each layer may then be imported as a mask covariate that is evaluated at the cell centroids to represent the surrounding area.</p>
<p>This example uses the <code>focal</code> function in the <strong>terra</strong> package <span class="citation" data-cites="R-terra">(<a href="A99-references.html#ref-R-terra" role="doc-biblioref">Hijmans, 2023</a>)</span> to compute both the proportion of forest cells in a square window and a Gaussian-smoothed proportion.</p>
<div class="cell">
<details class="code-fold"><summary>code for smoothed covariates</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># binary SpatRaster 0 = nonbeech, 1 = beech</span></span>
<span><span class="fu">covariates</span><span class="op">(</span><span class="va">ovmask</span><span class="op">)</span><span class="op">$</span><span class="va">forest_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span> <span class="op">(</span><span class="fu">covariates</span><span class="op">(</span><span class="va">ovmask</span><span class="op">)</span><span class="op">$</span><span class="va">forest</span> <span class="op">==</span> <span class="st">'beech'</span>, <span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html">rast</a></span><span class="op">(</span><span class="va">ovmask</span>, covariate <span class="op">=</span> <span class="st">'forest_num'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># square smoothing window: 5 cells</span></span>
<span><span class="va">tmpw5</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/focal.html">focal</a></span><span class="op">(</span><span class="va">tmp</span>, w <span class="op">=</span> <span class="fl">5</span>, <span class="st">"mean"</span>, na.policy <span class="op">=</span> <span class="st">"omit"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmpw5</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'w5'</span></span>
<span></span>
<span><span class="co"># Gaussian window, sigma 50 m</span></span>
<span><span class="co"># window radius is 3 sigma</span></span>
<span><span class="va">g50</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/focalMat.html">focalMat</a></span><span class="op">(</span><span class="va">tmp</span>, d <span class="op">=</span> <span class="fl">50</span>, type <span class="op">=</span> <span class="st">"Gauss"</span><span class="op">)</span></span>
<span><span class="va">tmpg50</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/focal.html">focal</a></span><span class="op">(</span><span class="va">tmp</span>, w <span class="op">=</span> <span class="va">g50</span>, <span class="st">"sum"</span>, na.policy <span class="op">=</span> <span class="st">"omit"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmpg50</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'g50'</span></span>
<span></span>
<span><span class="co"># add to mask</span></span>
<span><span class="va">ovmask</span> <span class="op">&lt;-</span> <span class="fu">addCovariates</span><span class="op">(</span><span class="va">ovmask</span>, <span class="va">tmpw5</span><span class="op">)</span></span>
<span><span class="va">ovmask</span> <span class="op">&lt;-</span> <span class="fu">addCovariates</span><span class="op">(</span><span class="va">ovmask</span>, <span class="va">tmpg50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, xpd <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ovmask</span>, cov <span class="op">=</span> <span class="st">'w5'</span>, dots <span class="op">=</span> <span class="cn">FALSE</span>, legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ovtrap</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span> <span class="op">(</span><span class="fl">2674600</span>, <span class="fl">5982892</span>, <span class="st">'a.'</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ovmask</span>, cov <span class="op">=</span> <span class="st">'g50'</span>, dots <span class="op">=</span> <span class="cn">FALSE</span>, legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ovtrap</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span> <span class="op">(</span><span class="fl">2674600</span>, <span class="fl">5982892</span>, <span class="st">'b.'</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-focalplot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-focalplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="11-density-model_files/figure-html/fig-focalplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" data-glightbox="description: .lightbox-desc-6"><img src="11-density-model_files/figure-html/fig-focalplot-1.png" class="img-fluid figure-img" style="width:95.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-focalplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.6: Smoothed forest covariate (proportion ‘beech’: 0% dark green, 100% white). (a) square window (5 <span class="math inline">\times</span> 5 cells), (b) Gaussian smooth (<span class="math inline">\sigma = 50</span> m).
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="prediction-and-plotting" class="level2" data-number="11.4"><h2 data-number="11.4" class="anchored" data-anchor-id="prediction-and-plotting">
<span class="header-section-number">11.4</span> Prediction and plotting</h2>
<p> </p>
<p>Fitting a model provides estimates of its coefficients or ‘beta parameters’; use the <code>coef</code> method to extract these from an <strong>secr</strong> object. The coefficients are usually of little use in themselves, but we can use them to make predictions. In order to plot a fitted model we first predict the height of the density surface at each point on a mask. As we have seen, this is done with <code>predictDsurface</code>, which has arguments <code>(object, mask = NULL, se.D = FALSE, cl.D = FALSE, alpha = 0.05)</code>. By default, prediction is at the mask points used when fitting the model (i.e.&nbsp;object$mask); specify the mask argument to extrapolate the model to a different area.</p>
<p>The output from <code>predictDsurface</code> is a specialised mask object called a Dsurface (class “c(‘Dsurface’, ‘mask’, ‘data.frame’)”). The covariate dataframe of a Dsurface has columns for the predicted density of each group (D.0 if there is only one). Usually when you print a mask you see only the x- and y-coordinates. The <code>print</code> method for Dsurface objects displays both the coordinates and the density values as one dataframe, as also do the <code>head</code> and <code>tail</code> methods.</p>
<p>Use the arguments ‘se.D’ and ‘cl.D’ to request computation of the estimated standard error and/or upper and lower confidence limits for each mask point<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. If requested, values are saved as additional covariates of the output Dsurface (SE.0, lcl.0, and ucl.0 if there is only one group).</p>
<p>The plot method for a Dsurface object has arguments <code>(x, covariate = "D", group = NULL, plottype = "shaded", scale = 1, ...)</code>. <code>covariate</code> may either be a prefix (one of “D”, “SE”, “lcl”, “ucl”) or any full covariate name. ‘plottype’ may be one of “shaded”, “dots”, “persp”, or “contour”. A coloured legend is displayed centre-right (see ?plot.mask and ?strip.legend for options).</p>
<p>For details on how to specify colours, levels etc. read the help pages for <code>plot.mask</code>, <code>contour</code> and <code>persp</code> (these functions may be controlled by extra arguments to <code>plot.Dsurface</code>, using the ‘dots’ convention).</p>
<p>A plot may be enhanced by the addition of contours. This is a challenge, because the <code>contour</code> function in R requires a rectangular matrix of values, and our mask is not rectangular. We could make it so with the <strong>secr</strong> function <code>rectangularMask</code>, which makes a rectangular Dsurface with missing (NA) values of density at all the external points. <code>plot.Dsurface</code> recognises an irregular mask and attempts to fix this with an internal call to <code>rectangularMask</code>.</p>
</section><section id="sec-scaling" class="level2" data-number="11.5"><h2 data-number="11.5" class="anchored" data-anchor-id="sec-scaling">
<span class="header-section-number">11.5</span> Scaling</h2>
<p></p>
<p>So far we have ignored the scaling of covariates, including geographic coordinates.</p>
<p><code>secr.fit</code> scales the x- and y-coordinates of mask points to mean = 0, SD = 1 before using the coordinates in a model. Remember this when you come to use the coefficients of a density model. Functions such as <code>predictDsurface</code> take care of scaling automatically. <code>predict.secr</code> uses the scaled values (‘newdata’ x = 0, y = 0), which provides the predicted density at the mask centroid. The mean and SD used in scaling are those saved as the `meanSD’ attribute of a mask (dataframe with columns ‘x’ and ‘y’ and rows ‘mean’ and ‘SD’).</p>
<p>Scaling of covariates other than x and y is up to the user. It is not usually needed.</p>
<p>The numerical algorithms for maximizing the likelihood work best when the absolute expected values are roughly similar for all parameters on their respective ‘link’ scales (i.e.&nbsp;all beta parameters) rather than varying by orders of magnitude. The default link function for D and sigma (log) places the values of these parameters on a scale that is not wildly different to the variation in g0 or lambda0, so this is seldom an issue. In extreme cases you may want to make allowance by setting the <code>typsize</code> argument of <code>nlm</code> or the <code>parscale</code> control argument of <code>optim</code> (via the … argument of <code>secr.fit</code>).</p>
<p>Scaling is not performed routinely by <code>secr.fit</code> for distance calculations. Sometimes, large numeric values in coordinates can cause loss of precision in distance calculations (there are a lot of them at each likelihood evaluation). The problem is serious in datasets that combine large coordinates with small detector spacing, such as the Lake Station <code>skink</code> dataset. Set <code>details = list(centred = TRUE)</code> to force scaling; this may become the default setting in a future version of <strong>secr</strong>.</p>
</section><section id="not-a-density-surface" class="level2" data-number="11.6"><h2 data-number="11.6" class="anchored" data-anchor-id="not-a-density-surface">
<span class="header-section-number">11.6</span> This is not a density surface</h2>
<p></p>
<p>The surfaces we have fitted involve inhomogeneous Poisson models for the distribution of animal home range centres. The models have parameters that determine the relationship of expected density to location or to habitat covariates.</p>
<p>Another type of plot is sometimes presented and described as a ‘density surface’ – the summed posterior distribution of estimated range centres from a Bayesian fit of a homogeneous Poisson model. A directly analogous plot may be obtained from the <strong>secr</strong> function <code>fxTotal</code> (see also <span class="citation" data-cites="be08">Borchers &amp; Efford (<a href="A99-references.html#ref-be08" role="doc-biblioref">2008</a>)</span> Section 4.3). The contours associated with the home range centre of each detected individual essentially represent 2-D confidence intervals for its home range centre, given the fitted observation model. Summing these gives a summed probability density surface for the centres of the observed individuals (‘D.fx’), and to this we can add an equivalent scaled probability density surface for the individuals that escaped detection (‘D.nc’). Both components are reported by <code>fx.total</code>, along with their sum (‘D.sum’) which we plot here for the flat possum model:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fxsurface</span> <span class="op">&lt;-</span> <span class="fu">fxTotal</span><span class="op">(</span><span class="va">fits</span><span class="op">$</span><span class="va">null</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">6</span>,<span class="fl">2</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fxsurface</span>, covariate <span class="op">=</span> <span class="st">"D.sum"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">30</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>     poly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ovtrap</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-OVfxsurfaceplt" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-OVfxsurfaceplt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="11-density-model_files/figure-html/fig-OVfxsurfaceplt-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" data-glightbox="description: .lightbox-desc-7"><img src="11-density-model_files/figure-html/fig-OVfxsurfaceplt-1.png" class="img-fluid figure-img" style="width:90.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-OVfxsurfaceplt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.7: Total fx surface
</figcaption></figure>
</div>
</div>
</div>
<p>The plot concerns only one realisation from the underlying Poisson model. It visually invites us to interpret patterns in that realisation that we have not modelled. There are serious problems with the interpretation of such plots as ‘density surfaces’:</p>
<ul>
<li><p>attention is focussed on the individuals that were detected; others that were present but not detected are represented by a smoothly varying base level that dominates in the outer region of the plot (contrast this figure with the previous quadratic and DTR3 models).</p></li>
<li><p>the surface depends on sampling intensity, and as more data are added it will change shape systematically. Ultimately, the surface near the centre of a detector array becomes a set of emergent peaks rising from an underwater plain of zero density, below the plateau of average density outside the array.</p></li>
<li><p>the ‘summed confidence interval’ plot is easily confused with the 2-D surface obtained by summing utilisation distributions across animals</p></li>
<li><p>confidence intervals are not available for the height of the probability density surface.</p></li>
</ul>
<p>The plots are also prone to artefacts. In some examples we see concentric clustering of estimated centres around the trapping grids, apparently ‘repelled’ from the traps themselves (e.g., plot below for a null model of the Waitarere ‘possumCH’ dataset in <strong>secr</strong>). This phenomenon appears to relate to lack of model fit (unpubl. results).</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fxsurfaceW</span> <span class="op">&lt;-</span> <span class="fu">fxTotal</span><span class="op">(</span><span class="va">possum.model.0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fxsurfaceW</span>, covariate <span class="op">=</span> <span class="st">"D.sum"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">0.5</span><span class="op">)</span>, </span>
<span>     poly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">traps</span><span class="op">(</span><span class="va">possumCH</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fxsurfaceWplt" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-fxsurfaceWplt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="11-density-model_files/figure-html/fig-fxsurfaceWplt-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" data-glightbox="description: .lightbox-desc-8"><img src="11-density-model_files/figure-html/fig-fxsurfaceWplt-1.png" class="img-fluid figure-img" style="width:90.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fxsurfaceWplt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.8: Waitarere possum fx surface
</figcaption></figure>
</div>
</div>
</div>
<p>See <span class="citation" data-cites="Durbach2024">Durbach et al. (<a href="A99-references.html#ref-Durbach2024" role="doc-biblioref">2024</a>)</span> for further critique.</p>
</section><section id="relativedensity2" class="level2" data-number="11.7"><h2 data-number="11.7" class="anchored" data-anchor-id="relativedensity2">
<span class="header-section-number">11.7</span> Relative density</h2>
<p></p>
<p>Theory for relative density models was given <a href="./03-theory.html#relativedensity1">earlier</a> (see also [Efford2025]). A spatial model for relative density is fitted in <strong>secr</strong> by setting <code>CL = TRUE</code> and providing a model for D in the call to <code>secr.fit</code> (<strong>secr</strong> <span class="math inline">\ge</span> 5.2.0). For example</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fitrd1</span> <span class="op">&lt;-</span> <span class="fu">secr.fit</span><span class="op">(</span>capthist <span class="op">=</span> <span class="va">OVpossumCH</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, mask <span class="op">=</span> <span class="va">ovmask</span>, </span>
<span>    trace <span class="op">=</span> <span class="cn">FALSE</span>, model <span class="op">=</span> <span class="va">D</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">y2</span> <span class="op">+</span> <span class="va">xy</span>, CL <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fitrd1</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          beta SE.beta
D.x   -0.19871 0.11851
D.y    0.30998 0.13469
D.x2  -0.22472 0.13345
D.y2  -0.09673 0.12818
D.xy   0.29672 0.13208
g0    -2.22032 0.09422
sigma  3.31767 0.03544</code></pre>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># compare coefficients from full fit:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fits</span><span class="op">$</span><span class="va">Dxy2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          beta SE.beta
D      2.72538 0.12781
D.x   -0.19871 0.11851
D.y    0.30999 0.13468
D.x2  -0.22471 0.13344
D.y2  -0.09674 0.12817
D.xy   0.29672 0.13208
g0    -2.22032 0.09422
sigma  3.31767 0.03544</code></pre>
</div>
</div>
<p>The relative density model is fitted by maximizing the likelihood conditional on <span class="math inline">n</span> and has one fewer coefficients than the absolute density model. Estimates of other coefficients are the same within numerical error (log link) or are scaled by the intercept (identity link).</p>
<p>The density intercept and other coefficients may be retrieved with the function <code>derivedDcoef</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">derivedDcoef</span><span class="op">(</span><span class="va">fitrd1</span><span class="op">)</span> <span class="co"># delta-method variance suppressed as unreliable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            beta   SE.beta        lcl        ucl
D      2.7253890        NA         NA         NA
D.x   -0.1987149 0.1185098 -0.4309898  0.0335599
D.y    0.3099849 0.1346873  0.0460026  0.5739672
D.x2  -0.2247201 0.1334477 -0.4862729  0.0368326
D.y2  -0.0967319 0.1281839 -0.3479677  0.1545040
D.xy   0.2967233 0.1320827  0.0378459  0.5556006
g0    -2.2203193 0.0942197 -2.4049865 -2.0356520
sigma  3.3176747 0.0354359  3.2482216  3.3871277</code></pre>
</div>
</div>
<p>To plot the full density surface it is first necessary to infer the missing intercept. This is done automatically by the function <code>derivedDsurface</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">6</span>,<span class="fl">2</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">derivedD</span> <span class="op">&lt;-</span> <span class="fu">derivedDsurface</span><span class="op">(</span><span class="va">fitrd1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">derivedD</span>, plottype <span class="op">=</span> <span class="st">"shaded"</span>, poly <span class="op">=</span> <span class="cn">FALSE</span>, breaks <span class="op">=</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">22</span>,<span class="fl">2</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"Density / ha"</span>, text.cex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">surfaceDxy2</span>, plottype <span class="op">=</span> <span class="st">"contour"</span>, poly <span class="op">=</span> <span class="cn">FALSE</span>, breaks <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">22</span>,<span class="fl">2</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">leftbank</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-relativeD" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-relativeD-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="11-density-model_files/figure-html/fig-relativeD-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" data-glightbox="description: .lightbox-desc-9"><img src="11-density-model_files/figure-html/fig-relativeD-1.png" class="img-fluid figure-img" style="width:90.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-relativeD-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.9: Possum density derived from quadratic relative density surface. Contour lines are from the previous full fit.
</figcaption></figure>
</div>
</div>
</div>
<p>The density in <a href="#fig-relativeD" class="quarto-xref">Fig.&nbsp;<span>11.9</span></a> nearly matches the absolute density in <a href="#fig-OVsurface" class="quarto-xref">Fig.&nbsp;<span>11.2</span></a>. This will not be the case if the relative density model is fitted to data from animals tagged elsewhere or on a subset of the area. Tagging then imposes differential spatial weighting that must be made explicit in the model to recover the correct pattern of density in relation to covariates. One scenario involves acoustic telemetry or other automated detection for which the only animals at risk of detection are those previously marked (cf resighting data, in which unmarked animals are detected and counted, but not identified).</p>


<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">Figure&nbsp;11.1: Orongorongo Valley possum study area</span>
<span class="glightbox-desc lightbox-desc-2">Figure&nbsp;11.2: Quadratic possum density surface</span>
<span class="glightbox-desc lightbox-desc-3">Figure&nbsp;11.3: Orongorongo Valley possum study: distance to river</span>
<span class="glightbox-desc lightbox-desc-4">Figure&nbsp;11.4: Possum density vs distance to river: regression spline <em>k</em> = 3</span>
<span class="glightbox-desc lightbox-desc-5">Figure&nbsp;11.5: Confidence surfaces</span>
<span class="glightbox-desc lightbox-desc-6">Figure&nbsp;11.6: Smoothed forest covariate (proportion ‘beech’: 0% dark green, 100% white). (a) square window (5 <span class="math inline">\times</span> 5 cells), (b) Gaussian smooth (<span class="math inline">\sigma = 50</span> m).</span>
<span class="glightbox-desc lightbox-desc-7">Figure&nbsp;11.7: Total fx surface</span>
<span class="glightbox-desc lightbox-desc-8">Figure&nbsp;11.8: Waitarere possum fx surface</span>
<span class="glightbox-desc lightbox-desc-9">Figure&nbsp;11.9: Possum density derived from quadratic relative density surface. Contour lines are from the previous full fit.</span>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-be08" class="csl-entry" role="listitem">
Borchers, D. L., &amp; Efford, M. G. (2008). Spatially explicit maximum likelihood methods for capture-recapture studies. <em>Biometrics</em>, <em>64</em>, 377–385.
</div>
<div id="ref-bk14" class="csl-entry" role="listitem">
Borchers, D. L., &amp; Kidney, D. J. (2014). <em>Flexible density surface estimation using regression splines with spatially explicit capture-recapture data</em>. In prep.
</div>
<div id="ref-bvns02" class="csl-entry" role="listitem">
Boyce, M. S., Vernier, P. R., Nielsen, S. E., &amp; Schmiegelow, F. K. A. (2002). Evaluating resource selection functions. <em>Ecological Modelling</em>, <em>157</em>, 281–300.
</div>
<div id="ref-Chandler2016" class="csl-entry" role="listitem">
Chandler, R., &amp; Hepinstall-Cymerman, J. (2016). Estimating the spatial scales of landscape effects on abundance. <em>Landscape Ecology</em>, <em>31</em>, 1383–1394. <a href="https://doi.org/10.1007/s10980-016-0380-z">https://doi.org/10.1007/s10980-016-0380-z</a>
</div>
<div id="ref-Durbach2024" class="csl-entry" role="listitem">
Durbach, I., Chopara, R., Borchers, D. L., Phillip, R., Sharma, K., &amp; Stevenson, B. C. (2024). That’s not the mona lisa! How to interpret spatial capture-recapture density surface estimates. <em>Biometrics</em>, <em>80</em>(1). <a href="https://doi.org/10.1093/biomtc/ujad020">https://doi.org/10.1093/biomtc/ujad020</a>
</div>
<div id="ref-Efford2025" class="csl-entry" role="listitem">
Efford, M. G. (2025). Spatially explicit capture–recapture models for relative density. <em>BioRxiv</em>. <a href="https://doi.org/10.1101/2025.01.22.634401">https://doi.org/10.1101/2025.01.22.634401</a>
</div>
<div id="ref-ec04" class="csl-entry" role="listitem">
Efford, M. G., &amp; Cowan, P. E. (2004). Long-term population trend of <em>trichosurus <span class="nocase">v</span>ulpecula</em> in the orongorongo valley, new zealand. In R. L. Goldingay &amp; S. M. Jackson (Eds.), <em>The biology of australian possums and gliders</em> (pp. 471–483). Surrey Beatty &amp; Sons.
</div>
<div id="ref-R-terra" class="csl-entry" role="listitem">
Hijmans, R. J. (2023). <em>Terra: Spatial data analysis</em>. <a href="https://CRAN.R-project.org/package=terra">https://CRAN.R-project.org/package=terra</a>
</div>
<div id="ref-Jackson2014" class="csl-entry" role="listitem">
Jackson, H. B., &amp; Fahrig, L. (2014). Are ecologists conducting research at the optimal scale? <em>Global Ecology and Biogeography</em>, <em>24</em>, 52–63. <a href="https://doi.org/10.1111/geb.12233">https://doi.org/10.1111/geb.12233</a>
</div>
<div id="ref-j80" class="csl-entry" role="listitem">
Johnson, D. H. (1980). The comparison of usage and availability measurements for evaluating resource preference. <em>Ecology</em>, <em>61</em>, 65–71.
</div>
<div id="ref-Kendeigh1944" class="csl-entry" role="listitem">
Kendeigh, S. C. (1944). Measurement of bird populations. <em>Ecological Monographs</em>, <em>14</em>, 67–106. <a href="https://doi.org/10.2307/1961632">https://doi.org/10.2307/1961632</a>
</div>
<div id="ref-w06" class="csl-entry" role="listitem">
Wood, S. N. (2006). <em>Generalized additive models: An introduction with <span>R</span></em>. Chapman; Hall/CRC.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>We can also express the model as before <span class="math inline">\mathbf y = \mathbf X \pmb {\beta}</span>, where <span class="math inline">\mathbf X</span> is the design matrix, <span class="math inline">\pmb{\beta}</span> is a vector of coefficients, and <span class="math inline">\mathbf y</span> is the resulting vector of densities on the link scale. Rows of <span class="math inline">\mathbf X</span> and elements of <span class="math inline">\mathbf y</span> correspond to points on the habitat mask, possibly replicated in the case of group and session effects.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>It may also be specified in a user-written function supplied to <code>secr.fit</code> (see <a href="A09-densityappendix.html" class="quarto-xref"><span>Appendix I</span></a>), but you are unlikely to need this. <br><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Option available only for models specified in generalized linear model form with the ‘model’ argument of secr.fit, not for user-defined functions.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="./10-detection-model.html" class="pagination-link" aria-label="Detection model">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Detection model</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./12-habitat.html" class="pagination-link" aria-label="Habitat mask">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Habitat mask</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"openEffect":"zoom","selector":".lightbox","closeEffect":"zoom","descPosition":"bottom","loop":false});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>


</body></html>